<!-- Enterprise Loading State Component Template -->
<div [ngClass]="getContainerClasses()" 
     *ngIf="isLoading"
     role="status"
     [attr.aria-label]="getLoadingMessage()">

  <!-- Overlay Background -->
  <div class="loading-backdrop" *ngIf="config.overlay"></div>

  <!-- Loading Content -->
  <div class="loading-content">

    <!-- Spinner Loading -->
    <div class="spinner-loading" *ngIf="config.type === 'spinner'">
      <mat-progress-spinner 
        mode="indeterminate"
        [diameter]="getSpinnerDiameter()"
        strokeWidth="3">
      </mat-progress-spinner>
      
      <div class="loading-text">
        <p class="loading-message">{{ getLoadingMessage() }}</p>
        
        <!-- Timer Display -->
        <small class="loading-timer" *ngIf="loadingTimer$ | async as timer">
          <mat-icon>schedule</mat-icon>
          {{ timer }}
        </small>
      </div>
    </div>

    <!-- Progress Bar Loading -->
    <div class="progress-loading" *ngIf="config.type === 'progress'">
      <div class="progress-content">
        <h4>{{ getLoadingMessage() }}</h4>
        
        <!-- Determinate Progress Bar -->
        <mat-progress-bar 
          *ngIf="progressPercent$ | async as progress"
          mode="determinate"
          [value]="progress"
          class="main-progress">
        </mat-progress-bar>
        
        <!-- Indeterminate Fallback -->
        <mat-progress-bar 
          *ngIf="!(progressPercent$ | async)"
          mode="indeterminate"
          class="main-progress">
        </mat-progress-bar>

        <div class="progress-details">
          <span class="progress-percentage" *ngIf="progressPercent$ | async as progress">
            {{ progress | number:'1.0-0' }}%
          </span>
          
          <span class="progress-timer" *ngIf="loadingTimer$ | async as timer">
            {{ timer }}
          </span>
        </div>
      </div>
    </div>

    <!-- Skeleton Loading -->
    <div class="skeleton-loading" *ngIf="config.type === 'skeleton'">
      <div class="skeleton-content" [ngSwitch]="context">
        
        <!-- Asset List Skeleton -->
        <div *ngSwitchCase="'asset-list'" class="skeleton-list">
          <div class="skeleton-header">
            <div class="skeleton-line skeleton-title"></div>
            <div class="skeleton-line skeleton-subtitle"></div>
          </div>
          
          <div class="skeleton-table">
            <div class="skeleton-row" *ngFor="let row of [1,2,3,4,5]">
              <div class="skeleton-cell" 
                   *ngFor="let width of getSkeletonConfig().columns"
                   [style.width]="width">
              </div>
            </div>
          </div>
        </div>

        <!-- Asset Detail Skeleton -->
        <div *ngSwitchCase="'asset-detail'" class="skeleton-detail">
          <div class="skeleton-header">
            <div class="skeleton-avatar"></div>
            <div class="skeleton-info">
              <div class="skeleton-line skeleton-name"></div>
              <div class="skeleton-line skeleton-subtitle"></div>
            </div>
          </div>
          
          <div class="skeleton-body">
            <div class="skeleton-section" *ngFor="let section of [1,2,3]">
              <div class="skeleton-line skeleton-section-title"></div>
              <div class="skeleton-line" *ngFor="let line of [1,2,3]"></div>
            </div>
          </div>
        </div>

        <!-- Dashboard Skeleton -->
        <div *ngSwitchCase="'dashboard'" class="skeleton-dashboard">
          <div class="skeleton-cards">
            <div class="skeleton-card" *ngFor="let card of [1,2,3,4]">
              <div class="skeleton-line skeleton-card-title"></div>
              <div class="skeleton-line skeleton-card-value"></div>
            </div>
          </div>
        </div>

        <!-- Default Skeleton -->
        <div *ngSwitchDefault class="skeleton-default">
          <div class="skeleton-line" *ngFor="let line of [1,2,3,4]"></div>
        </div>
      </div>
    </div>

    <!-- Dots Loading -->
    <div class="dots-loading" *ngIf="config.type === 'dots'">
      <div class="loading-dots">
        <div class="dot" *ngFor="let dot of [1,2,3]"></div>
      </div>
      <p class="loading-message">{{ getLoadingMessage() }}</p>
    </div>

    <!-- Pulse Loading -->
    <div class="pulse-loading" *ngIf="config.type === 'pulse'">
      <div class="pulse-circle"></div>
      <p class="loading-message">{{ getLoadingMessage() }}</p>
    </div>

    <!-- Loading Tips -->
    <div class="loading-tips" 
         *ngIf="config.showTips && (currentTip$ | async) as tip">
      <mat-card class="tip-card">
        <div class="tip-content">
          <mat-icon [class]="'tip-icon tip-' + tip.category">{{ tip.icon }}</mat-icon>
          <span class="tip-text">{{ tip.text }}</span>
        </div>
      </mat-card>
    </div>

    <!-- Performance Warning -->
    <div class="performance-warning" 
         *ngIf="shouldShowCancelOption()"
         class="slow-loading-notice">
      <mat-card class="warning-card">
        <div class="warning-content">
          <mat-icon color="warn">schedule</mat-icon>
          <div class="warning-text">
            <p>This is taking longer than usual...</p>
            <small>Large datasets may take extra time to process</small>
          </div>
          <button mat-stroked-button 
                  color="warn"
                  (click)="onCancel()"
                  class="cancel-button">
            <mat-icon>cancel</mat-icon>
            Cancel
          </button>
        </div>
      </mat-card>
    </div>

    <!-- Debug Information (Development Mode) -->
    <div class="debug-info" 
         *ngIf="false" 
         class="loading-debug">
      <details>
        <summary>Debug Info</summary>
        <pre>{{ {
          context: context,
          config: config,
          startTime: startTime,
          elapsed: (performance.now ? performance.now() - startTime : 0) + 'ms'
        } | json }}</pre>
      </details>
    </div>

  </div>

  <!-- Accessibility -->
  <div class="sr-only" aria-live="polite" aria-atomic="true">
    {{ getLoadingMessage() }}
    <span *ngIf="progressPercent$ | async as progress">
      {{ progress | number:'1.0-0' }}% complete
    </span>
  </div>

</div>

<!-- Demo Controls (for development/demonstration) -->
<div class="demo-controls" *ngIf="false" style="position: fixed; bottom: 20px; right: 20px; z-index: 9999;">
  <mat-card>
    <mat-card-title>Loading Demo</mat-card-title>
    <mat-card-actions>
      <button mat-button (click)="simulateFastLoading()">Fast</button>
      <button mat-button (click)="simulateSlowLoading()">Slow</button>
      <button mat-button (click)="simulateSkeletonLoading()">Skeleton</button>
    </mat-card-actions>
  </mat-card>
</div>