<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phase 3.1 Test - RareLanguages</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for mobile-first responsive design */
        .touch-manipulation { touch-action: manipulation; }
        
        /* Card flip animation */
        @keyframes flipCard {
            0% { transform: rotateY(0); }
            50% { transform: rotateY(-90deg); }
            100% { transform: rotateY(0); }
        }
        
        .card-flip {
            animation: flipCard 0.6s ease-in-out;
        }
        
        /* Swipe indicators */
        .swipe-indicator {
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .card:hover .swipe-indicator {
            opacity: 1;
        }
        
        /* Mobile optimizations */
        @media (max-width: 640px) {
            .mobile-padding { padding: 1rem; }
            .mobile-text { font-size: 0.875rem; }
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
        // Mock data for testing
        const mockContent = [
            {
                id: 1,
                english_phrase: "Hello, how are you?",
                target_phrase: "Tungjatjeta, si jeni?",
                pronunciation_guide: "toon-gya-tye-ta, see YEH-nee",
                cultural_context: "A formal greeting used when meeting someone for the first time or in respectful situations."
            },
            {
                id: 2,
                english_phrase: "Thank you very much",
                target_phrase: "Faleminderit shumÃ«",
                pronunciation_guide: "fah-leh-meen-deh-reet SHOO-muh",
                cultural_context: "Always use 'faleminderit' to show gratitude - it's very important in Albanian culture."
            }
        ];

        // Mock AppContext
        const AppContext = React.createContext();

        const AppProvider = ({ children }) => {
            const [currentPage, setCurrentPage] = React.useState('home');
            const [selectedLanguage, setSelectedLanguage] = React.useState(null);
            const [navigationHistory, setNavigationHistory] = React.useState(['home']);
            const [completedLessons, setCompletedLessons] = React.useState(new Set());
            const [learnedTopics, setLearnedTopics] = React.useState(new Set());
            const [currentLesson, setCurrentLesson] = React.useState(null);

            const mockLessons = [
                {
                    id: 'lesson_1',
                    title: 'Greetings & Basics',
                    description: 'Essential greetings for family interactions',
                    difficulty: 1,
                    estimatedMinutes: 8,
                    content: mockContent,
                    topics: ['greetings', 'basics']
                }
            ];

            const navigateTo = (page, params = {}) => {
                setNavigationHistory(prev => [...prev, currentPage]);
                setCurrentPage(page);
                
                if (page === 'lesson' && params.lessonId) {
                    const lesson = mockLessons.find(l => l.id === params.lessonId);
                    setCurrentLesson(lesson);
                }
            };

            const goBack = () => {
                if (navigationHistory.length > 1) {
                    const previousPage = navigationHistory[navigationHistory.length - 1];
                    setNavigationHistory(prev => prev.slice(0, -1));
                    setCurrentPage(previousPage);
                }
            };

            const getNextLesson = () => mockLessons[0];

            const getAppSummary = () => ({
                totalLessons: mockLessons.length,
                completedLessons: completedLessons.size,
                learnedTopics: learnedTopics.size
            });

            const getCurrentLessonProgress = () => ({
                completed: false,
                exercisesCompleted: 0,
                totalExercises: 4,
                accuracy: 0
            });

            const updateLessonProgress = (lessonId, progress) => {
                console.log('Updating progress:', lessonId, progress);
            };

            const preferences = {
                pronunciationShown: true,
                culturalContextShown: true
            };

            const value = {
                currentPage,
                selectedLanguage,
                currentLesson,
                navigationHistory,
                completedLessons,
                learnedTopics,
                mockLessons,
                preferences,
                navigateTo,
                goBack,
                setSelectedLanguage,
                getNextLesson,
                getAppSummary,
                getCurrentLessonProgress,
                updateLessonProgress,
                getPracticeContent: () => [],
                getCompletedLessons: () => []
            };

            return (
                <AppContext.Provider value={value}>
                    {children}
                </AppContext.Provider>
            );
        };

        const useApp = () => {
            const context = React.useContext(AppContext);
            if (!context) throw new Error('useApp must be used within AppProvider');
            return context;
        };

        // Simple Header component
        const Header = () => {
            const { currentPage, goBack, navigationHistory } = useApp();
            
            const getPageTitle = (page) => {
                const titles = {
                    home: 'RareLanguages',
                    dashboard: 'Gheg Albanian',
                    lesson: 'Learning Session',
                    practice: 'Practice Hub'
                };
                return titles[page] || 'RareLanguages';
            };
            
            const showBackButton = navigationHistory.length > 1 && currentPage !== 'home';
            
            return (
                <header className="bg-white border-b border-gray-200">
                    <div className="max-w-4xl mx-auto px-4 py-3">
                        <div className="flex items-center justify-between">
                            <div className="flex items-center gap-3">
                                {showBackButton && (
                                    <button
                                        onClick={goBack}
                                        className="p-2 -ml-2 text-gray-600 hover:text-gray-900 rounded-lg hover:bg-gray-100"
                                    >
                                        <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" />
                                        </svg>
                                    </button>
                                )}
                                <h1 className="text-xl font-bold text-gray-900">
                                    {getPageTitle(currentPage)}
                                </h1>
                            </div>
                        </div>
                    </div>
                </header>
            );
        };

        // Simple Layout component
        const Layout = ({ children }) => {
            const { currentPage } = useApp();
            
            return (
                <div className="min-h-screen bg-gray-50">
                    <Header />
                    <main className="pb-6">
                        <div className={`mx-auto px-4 ${currentPage === 'lesson' ? 'max-w-full' : 'max-w-md md:max-w-2xl'}`}>
                            {children}
                        </div>
                    </main>
                </div>
            );
        };

        // HomePage component
        const HomePage = () => {
            const { navigateTo, setSelectedLanguage, selectedLanguage } = useApp();
            
            const handleLanguageSelect = (language) => {
                setSelectedLanguage(language);
            };
            
            React.useEffect(() => {
                if (selectedLanguage) {
                    const timer = setTimeout(() => {
                        navigateTo('dashboard');
                    }, 500);
                    return () => clearTimeout(timer);
                }
            }, [selectedLanguage, navigateTo]);
            
            return (
                <div className="pt-16 pb-8">
                    <div className="text-center space-y-8">
                        <div className="space-y-4">
                            <div className="text-4xl font-bold text-gray-900">RareLanguages</div>
                            <p className="text-xl text-gray-600">Learn Rare Languages</p>
                            <p className="text-gray-500 max-w-sm mx-auto leading-relaxed">
                                Master languages that bring you closer to family and culture
                            </p>
                        </div>
                        
                        <div className="space-y-6">
                            <h2 className="text-lg font-medium text-gray-700">Choose your language:</h2>
                            
                            <button
                                onClick={() => handleLanguageSelect('gheg-albanian')}
                                className={`w-full max-w-xs mx-auto flex items-center justify-center gap-3 p-4 rounded-lg border-2 transition-all ${
                                    selectedLanguage === 'gheg-albanian'
                                        ? 'border-blue-500 bg-blue-50 text-blue-900'
                                        : 'border-gray-200 bg-white text-gray-700 hover:border-gray-300 hover:bg-gray-50'
                                }`}
                            >
                                <span className="text-2xl">ðŸ‡¦ðŸ‡±</span>
                                <div className="text-left">
                                    <div className="font-medium">Gheg Albanian</div>
                                    <div className="text-sm opacity-75">Kosovo dialect</div>
                                </div>
                                {selectedLanguage === 'gheg-albanian' && (
                                    <svg className="w-5 h-5 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
                                        <path fillRule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clipRule="evenodd" />
                                    </svg>
                                )}
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // LessonDashboard component
        const LessonDashboard = () => {
            const { navigateTo, getNextLesson, mockLessons, getAppSummary } = useApp();
            
            const nextLesson = getNextLesson();
            const appSummary = getAppSummary();
            
            const handleContinueLesson = () => {
                if (nextLesson) {
                    navigateTo('lesson', { lessonId: nextLesson.id });
                }
            };
            
            return (
                <div className="pt-6 space-y-8">
                    <div className="text-center">
                        <h1 className="text-2xl font-bold text-gray-900 mb-2">ðŸ‡¦ðŸ‡± Gheg Albanian</h1>
                        <p className="text-gray-600">Ready to connect with your Albanian family</p>
                    </div>
                    
                    <div className="space-y-4">
                        <button
                            onClick={handleContinueLesson}
                            className="w-full bg-blue-600 hover:bg-blue-700 text-white py-6 px-6 rounded-lg text-xl font-medium transition-colors shadow-sm"
                        >
                            <div className="space-y-1">
                                <div>Continue Your Lesson</div>
                                <div className="text-blue-100 text-base font-normal">
                                    {nextLesson?.title || 'Start Learning'}
                                </div>
                            </div>
                        </button>
                    </div>
                    
                    <div className="bg-white rounded-lg border border-gray-200 p-4">
                        <h2 className="font-medium text-gray-900 mb-3">Your Progress</h2>
                        <div className="grid grid-cols-2 gap-4 text-center">
                            <div>
                                <div className="text-2xl font-bold text-blue-600">{appSummary.completedLessons}</div>
                                <div className="text-sm text-gray-600">Lessons Completed</div>
                            </div>
                            <div>
                                <div className="text-2xl font-bold text-green-600">{appSummary.learnedTopics}</div>
                                <div className="text-sm text-gray-600">Topics Learned</div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // Simple LessonPlayer demo
        const LessonPlayer = () => {
            const { navigateTo, currentLesson } = useApp();
            
            if (!currentLesson) {
                return (
                    <div className="min-h-screen bg-gray-50 flex items-center justify-center">
                        <div className="text-center">
                            <h2 className="text-xl font-bold text-gray-900 mb-2">No Lesson Selected</h2>
                            <button
                                onClick={() => navigateTo('dashboard')}
                                className="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg"
                            >
                                Back to Dashboard
                            </button>
                        </div>
                    </div>
                );
            }
            
            return (
                <div className="min-h-screen bg-gray-50">
                    <div className="bg-white border-b border-gray-200 p-4">
                        <div className="max-w-4xl mx-auto">
                            <div className="flex items-center gap-3 mb-4">
                                <div className="text-2xl">ðŸ“–</div>
                                <div className="flex-1">
                                    <h1 className="text-xl font-bold text-gray-900">{currentLesson.title}</h1>
                                    <p className="text-sm text-gray-600">{currentLesson.description}</p>
                                </div>
                                <button
                                    onClick={() => navigateTo('dashboard')}
                                    className="text-gray-500 hover:text-gray-700 p-2 rounded-lg hover:bg-gray-100"
                                >
                                    <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div className="py-6">
                        <div className="max-w-2xl mx-auto p-4 text-center">
                            <div className="bg-blue-50 border border-blue-200 rounded-lg p-8">
                                <div className="text-4xl mb-4">ðŸš€</div>
                                <h2 className="text-xl font-bold text-blue-900 mb-2">Phase 3.1 Complete!</h2>
                                <p className="text-blue-700 mb-4">
                                    The navigation system is working perfectly. Exercise components from Phase 2.2 would load here.
                                </p>
                                <button
                                    onClick={() => navigateTo('dashboard')}
                                    className="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg"
                                >
                                    Back to Dashboard
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // Main App Router
        const AppRouter = () => {
            const { currentPage } = useApp();
            
            const renderCurrentPage = () => {
                switch (currentPage) {
                    case 'home':
                        return <HomePage />;
                    case 'dashboard':
                        return <LessonDashboard />;
                    case 'lesson':
                        return <LessonPlayer />;
                    default:
                        return <HomePage />;
                }
            };
            
            return (
                <Layout>
                    {renderCurrentPage()}
                </Layout>
            );
        };

        // Root App
        const App = () => {
            return (
                <AppProvider>
                    <AppRouter />
                </AppProvider>
            );
        };

        // Render the app
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>