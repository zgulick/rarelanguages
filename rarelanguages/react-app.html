<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🇦🇱 Learn Albanian - Kosovo Family Integration</title>
    
    <!-- React CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            min-height: 100vh;
            color: #1e293b;
        }
        
        .app-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }
        
        /* Landing Dashboard Styles */
        .dashboard {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            color: #0f172a;
            padding: 40px 20px;
        }
        
        .app-header {
            margin-bottom: 50px;
        }
        
        .app-title {
            font-size: 4em;
            margin-bottom: 15px;
            color: #0f172a;
            font-weight: 700;
        }
        
        .app-subtitle {
            font-size: 1.4em;
            color: #374151;
            font-weight: 500;
            margin-bottom: 10px;
        }
        
        .app-tagline {
            font-size: 1.1em;
            color: #64748b;
            font-style: italic;
        }
        
        .continue-section {
            margin-bottom: 60px;
        }
        
        .continue-button {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border: none;
            border-radius: 20px;
            padding: 25px 50px;
            font-size: 1.3em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.3);
            min-width: 300px;
        }
        
        .continue-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(16, 185, 129, 0.4);
        }
        
        .continue-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .learning-paths {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
            width: 100%;
            max-width: 800px;
        }
        
        .path-card {
            background: white;
            border-radius: 20px;
            padding: 40px 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            border: 3px solid transparent;
        }
        
        .path-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
            border-color: #2563eb;
        }
        
        .path-icon {
            font-size: 3.5em;
            margin-bottom: 20px;
            display: block;
        }
        
        .path-title {
            font-size: 1.6em;
            font-weight: 700;
            color: #0f172a;
            margin-bottom: 15px;
        }
        
        .path-description {
            color: #64748b;
            font-size: 1.1em;
            line-height: 1.6;
        }
        
        .quick-stats {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 16px;
            padding: 28px;
            margin-top: 40px;
            border: 1px solid #e2e8f0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #047857;
            display: block;
        }
        
        .stat-label {
            font-size: 1em;
            color: #64748b;
            font-weight: 500;
        }
        
        /* Topic Selection Styles */
        .topic-selection {
            background: white;
            border-radius: 25px;
            padding: 40px;
            margin: 20px 0;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
        }
        
        .topic-header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .topic-title {
            font-size: 2.5em;
            color: #0f172a;
            margin-bottom: 15px;
            font-weight: 700;
        }
        
        .topic-subtitle {
            font-size: 1.3em;
            color: #64748b;
            font-weight: 300;
        }
        
        .topics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
        }
        
        .topic-card {
            background: linear-gradient(135deg, #f8faff 0%, #ffffff 100%);
            border: 2px solid #e2e8f0;
            border-radius: 20px;
            padding: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .topic-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #2563eb, #764ba2);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }
        
        .topic-card:hover::before {
            transform: scaleX(1);
        }
        
        .topic-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(102, 126, 234, 0.2);
            border-color: #2563eb;
        }
        
        .topic-card-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .topic-emoji {
            font-size: 2.5em;
            margin-right: 15px;
        }
        
        .topic-card-title {
            font-size: 1.5em;
            font-weight: 700;
            color: #0f172a;
        }
        
        .topic-description {
            color: #64748b;
            font-size: 1.1em;
            line-height: 1.6;
            margin-bottom: 20px;
        }
        
        .topic-stats {
            display: flex;
            justify-content: space-between;
            font-size: 0.9em;
            color: #888;
            margin-bottom: 20px;
        }
        
        .topic-grammar {
            background: #f0f4ff;
            border-left: 4px solid #2563eb;
            padding: 12px 16px;
            border-radius: 8px;
            font-style: italic;
            color: #4c51bf;
            margin-bottom: 20px;
        }
        
        .start-topic-btn {
            width: 100%;
            background: linear-gradient(135deg, #2563eb 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 15px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .start-topic-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
        }
        
        /* Topic Lesson Styles */
        .topic-lesson {
            background: white;
            border-radius: 25px;
            padding: 40px;
            margin: 20px 0;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            min-height: 70vh;
        }
        
        .lesson-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f0f4ff;
        }
        
        .lesson-title-section h2 {
            font-size: 2em;
            color: #0f172a;
            margin-bottom: 5px;
        }
        
        .lesson-subtitle {
            color: #64748b;
            font-size: 1.1em;
        }
        
        .lesson-progress {
            background: #f8faff;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
        }
        
        .progress-bar {
            background: #e2e8f0;
            border-radius: 8px;
            height: 12px;
            overflow: hidden;
            margin-bottom: 15px;
        }
        
        .progress-fill {
            background: linear-gradient(90deg, #2563eb, #764ba2);
            height: 100%;
            transition: width 0.5s ease;
        }
        
        .progress-steps {
            display: flex;
            justify-content: space-between;
            font-size: 0.9em;
            color: #64748b;
        }
        
        .progress-step {
            padding: 5px 10px;
            border-radius: 6px;
            transition: all 0.3s ease;
        }
        
        .progress-step.active {
            background: #2563eb;
            color: white;
            font-weight: 600;
        }
        
        .progress-step.completed {
            background: #10b981;
            color: white;
        }
        
        /* Theory Section Styles */
        .theory-section {
            padding: 30px 0;
        }
        
        .cultural-context {
            background: linear-gradient(135deg, #fef9e7 0%, #fef3c7 100%);
            border-left: 5px solid #f59e0b;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
        }
        
        .cultural-context h3 {
            color: #92400e;
            font-size: 1.4em;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }
        
        .cultural-context h3::before {
            content: '🏛️';
            margin-right: 10px;
        }
        
        .grammar-focus {
            background: linear-gradient(135deg, #f0f4ff 0%, #e7f1ff 100%);
            border-left: 5px solid #2563eb;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
        }
        
        .grammar-focus h3 {
            color: #4c51bf;
            font-size: 1.4em;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }
        
        .grammar-focus h3::before {
            content: '📚';
            margin-right: 10px;
        }
        
        .grammar-examples {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-top: 15px;
        }
        
        .example-sentence {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .example-sentence:last-child {
            border-bottom: none;
        }
        
        .lesson-preview {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border-left: 5px solid #10b981;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
        }
        
        .lesson-preview h3 {
            color: #166534;
            font-size: 1.4em;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }
        
        .lesson-preview h3::before {
            content: '🎯';
            margin-right: 10px;
        }
        
        .lesson-preview ul {
            list-style: none;
            padding: 0;
        }
        
        .lesson-preview li {
            padding: 8px 0;
            position: relative;
            padding-left: 25px;
        }
        
        .lesson-preview li::before {
            content: '✓';
            position: absolute;
            left: 0;
            color: #10b981;
            font-weight: bold;
        }
        
        /* Exercise Styles */
        .exercise-container {
            background: linear-gradient(135deg, #f8faff 0%, #ffffff 100%);
            border: 2px solid #e2e8f0;
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            min-height: 500px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            position: relative;
        }
        
        .exercise-type {
            position: absolute;
            top: 20px;
            right: 25px;
            background: #2563eb;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
        }
        
        .flashcard-front, .flashcard-back {
            padding: 40px 20px;
        }
        
        .english-prompt {
            font-size: 2.2em;
            color: #0f172a;
            margin-bottom: 30px;
            font-weight: 500;
            line-height: 1.3;
        }
        
        .albanian-answer {
            font-size: 2.8em;
            color: #2563eb;
            font-weight: bold;
            margin: 20px 0;
            line-height: 1.2;
        }
        
        .pronunciation {
            font-size: 1.3em;
            color: #888;
            font-style: italic;
            margin: 10px 0;
        }
        
        .cultural-note {
            background: #fef9e7;
            border-left: 4px solid #f59e0b;
            padding: 15px 20px;
            margin: 20px 0;
            border-radius: 8px;
            font-style: italic;
            color: #78350f;
            text-align: left;
        }
        
        .difficulty-stars {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin: 20px 0;
        }
        
        .star {
            font-size: 1.5em;
            color: #fbbf24;
        }
        
        .star.empty {
            color: #e5e7eb;
        }
        
        /* Button Styles */
        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 12px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
            min-width: 140px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }
        
        .btn-primary {
            background: #1e40af;
            color: #ffffff;
            border: 1px solid #1d4ed8;
        }
        
        .btn-success {
            background: #047857;
            color: #ffffff;
            border: 1px solid #059669;
        }
        
        .btn-warning {
            background: #b45309;
            color: #ffffff;
            border: 1px solid #d97706;
        }
        
        .btn-danger {
            background: #dc2626;
            color: #ffffff;
            border: 1px solid #ef4444;
        }
        
        .btn-secondary {
            background: #374151;
            color: #ffffff;
            border: 1px solid #4b5563;
        }
        
        .btn-outline {
            background: transparent;
            border: 2px solid #2563eb;
            color: #2563eb;
        }
        
        .btn-outline:hover {
            background: #1e40af;
            color: #ffffff;
        }
        
        /* Navigation */
        .nav-bar {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid #e2e8f0;
            border-radius: 16px;
            padding: 15px 25px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: #0f172a;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        
        .nav-back {
            background: #f1f5f9;
            border: 1px solid #e2e8f0;
            color: #374151;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }
        
        .nav-back:hover {
            background: #e2e8f0;
            color: #0f172a;
        }
        
        .nav-title {
            font-size: 1.3em;
            font-weight: 600;
            color: #0f172a;
        }
        
        .nav-progress {
            font-size: 0.9em;
            color: #64748b;
            font-weight: 500;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .app-title {
                font-size: 2.5em;
            }
            
            .learning-paths {
                grid-template-columns: 1fr;
            }
            
            .topics-grid {
                grid-template-columns: 1fr;
            }
            
            .topic-lesson {
                padding: 20px;
            }
            
            .exercise-container {
                padding: 20px;
            }
            
            .english-prompt {
                font-size: 1.8em;
            }
            
            .albanian-answer {
                font-size: 2.2em;
            }
        }
        
        /* Animations */
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        .slide-in {
            animation: slideIn 0.5s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(30px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        .pulse {
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        /* Loading States */
        .loading {
            opacity: 0.6;
            pointer-events: none;
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #2563eb;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Exercise Specific Styles */
        .conversation-scenario {
            background: #f8faff;
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
            text-align: left;
        }
        
        .conversation-character {
            font-weight: 600;
            color: #2563eb;
            margin-bottom: 10px;
        }
        
        .conversation-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 20px 0;
        }
        
        .option-button {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 15px 20px;
            text-align: left;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .option-button:hover {
            border-color: #2563eb;
            background: #f8faff;
        }
        
        .option-button.selected {
            border-color: #2563eb;
            background: #2563eb;
            color: white;
        }
        
        .audio-controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
        }
        
        .audio-btn {
            background: #2563eb;
            color: white;
            border: none;
            border-radius: 50px;
            padding: 20px;
            font-size: 1.5em;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .audio-btn:hover {
            background: #5a67d8;
            transform: scale(1.1);
        }
        
        .visual-exercise {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .visual-option {
            background: white;
            border: 3px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-size: 3em;
        }
        
        .visual-option:hover {
            border-color: #2563eb;
            transform: scale(1.05);
        }
        
        .visual-option.selected {
            border-color: #2563eb;
            background: #f8faff;
        }
        
        /* Verb Section Styles */
        .verb-section {
            background: white;
            border-radius: 25px;
            padding: 40px;
            margin: 20px 0;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
        }
        
        .verb-section.loading, .verb-section.error {
            text-align: center;
            padding: 60px 40px;
            color: #64748b;
        }
        
        
        .verb-info {
            margin-bottom: 30px;
        }
        
        .verb-info h4 {
            font-size: 1.8em;
            color: #0f172a;
            margin-bottom: 10px;
        }
        
        .verb-type {
            color: #10b981;
            font-weight: 600;
            text-transform: capitalize;
            margin-bottom: 15px;
        }
        
        .cultural-note {
            background: #fef9e7;
            border-left: 4px solid #f59e0b;
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .conjugation-table {
            margin-bottom: 30px;
        }
        
        .conjugation-table h5 {
            font-size: 1.3em;
            color: #0f172a;
            margin-bottom: 20px;
            border-bottom: 2px solid #f0f4ff;
            padding-bottom: 10px;
        }
        
        .conjugations-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            background: #f8faff;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
        }
        
        .conjugation-column {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .conjugation-item {
            display: grid;
            grid-template-columns: auto 1fr auto;
            gap: 12px;
            align-items: center;
            padding: 12px 16px;
            background: white;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
            min-height: 50px;
        }
        
        .conjugation-item .person {
            font-weight: 600;
            color: #2563eb;
            text-align: left;
            white-space: nowrap;
            min-width: 50px;
        }
        
        .conjugation-item .form {
            font-weight: bold;
            color: #0f172a;
            text-align: center;
            font-size: 1.1em;
        }
        
        .conjugation-item .translation {
            color: #64748b;
            font-style: italic;
            font-size: 0.9em;
            text-align: right;
        }
        
        /* Mobile Responsive */
        @media (max-width: 768px) {
            .conjugations-grid {
                grid-template-columns: 1fr;
                gap: 15px;
                padding: 20px;
            }
            
            .conjugation-item {
                grid-template-columns: 1fr;
                text-align: center;
                gap: 8px;
                padding: 16px;
            }
            
            .conjugation-item .person {
                text-align: center;
                font-size: 0.9em;
                color: #2563eb;
                border-bottom: 1px solid #f0f4ff;
                padding-bottom: 6px;
            }
            
            .conjugation-item .form {
                font-size: 1.3em;
                color: #0f172a;
                margin: 4px 0;
            }
            
            .conjugation-item .translation {
                text-align: center;
                font-size: 0.95em;
                color: #64748b;
                border-top: 1px solid #f0f4ff;
                padding-top: 6px;
            }
            
            .verb-card {
                padding: 20px;
                margin-bottom: 20px;
            }
            
            .verb-section {
                padding: 20px;
            }
        }
        
        .verb-card {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            transition: all 0.3s ease;
        }
        
        .verb-card:hover {
            border-color: #2563eb;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.1);
        }
        
        .verb-examples {
            background: #f0fdf4;
            border-radius: 12px;
            padding: 20px;
        }
        
        .verb-examples h5 {
            font-size: 1.2em;
            color: #166534;
            margin-bottom: 15px;
        }
        
        .example {
            margin-bottom: 15px;
            padding: 12px;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #10b981;
        }
        
        .example .albanian {
            font-weight: 600;
            color: #0f172a;
            margin-bottom: 5px;
        }
        
        .example .english {
            color: #64748b;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;
        
        // Main App Component
        const App = () => {
            const [currentView, setCurrentView] = useState('home');
            const [currentTopic, setCurrentTopic] = useState(null);
            const [currentLesson, setCurrentLesson] = useState(null);
            const [appData, setAppData] = useState({
                totalPhrases: 0,
                learnedCount: 0,
                topics: [],
                userProgress: {}
            });
            const [loading, setLoading] = useState(false);
            
            // Load app data on mount
            useEffect(() => {
                loadAppData();
                loadUserProgress();
            }, []);
            
            // Scroll to top when view changes
            useEffect(() => {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }, [currentView, currentTopic]);
            
            const loadAppData = async () => {
                setLoading(true);
                try {
                    const [countResponse, categoriesResponse] = await Promise.all([
                        fetch('/api/count'),
                        fetch('/api/categories')
                    ]);
                    
                    const countData = await countResponse.json();
                    const categoriesData = await categoriesResponse.json();
                    
                    setAppData(prev => ({
                        ...prev,
                        totalPhrases: parseInt(countData.count),
                        topics: categoriesData.map(cat => ({
                            id: cat.name.toLowerCase().replace(/\\s+/g, '_'),
                            name: cat.name,
                            count: parseInt(cat.count),
                            icon: getTopicIcon(cat.name),
                            description: getTopicDescription(cat.name),
                            grammar: getTopicGrammar(cat.name)
                        }))
                    }));
                } catch (error) {
                    console.error('Failed to load app data:', error);
                } finally {
                    setLoading(false);
                }
            };
            
            const loadUserProgress = () => {
                const saved = localStorage.getItem('albanianLearningProgress');
                if (saved) {
                    const progress = JSON.parse(saved);
                    setAppData(prev => ({
                        ...prev,
                        learnedCount: progress.learnedCount || 0,
                        userProgress: progress.topics || {}
                    }));
                }
            };
            
            const saveUserProgress = (updates) => {
                const currentProgress = JSON.parse(localStorage.getItem('albanianLearningProgress') || '{}');
                const newProgress = { ...currentProgress, ...updates };
                localStorage.setItem('albanianLearningProgress', JSON.stringify(newProgress));
                setAppData(prev => ({ ...prev, ...updates }));
            };
            
            const getTopicIcon = (name) => {
                const iconMap = {
                    'Playing Cards': '🃏',
                    'Card Game Terms': '🎯',
                    'Hello and Goodbye': '👋',
                    'Winning & Losing': '🏆',
                    'Food Names': '🍽️',
                    'Home & Rooms': '🏠',
                    'Daily Activities': '🌅',
                    'Expressing Opinions': '💭',
                    'Emotions & Feelings': '😊',
                    'Coffee': '☕',
                    'Family': '👨‍👩‍👧‍👦',
                    'Greetings': '🤝'
                };
                
                for (const [key, icon] of Object.entries(iconMap)) {
                    if (name.toLowerCase().includes(key.toLowerCase())) {
                        return icon;
                    }
                }
                return '📚';
            };
            
            const getTopicDescription = (name) => {
                const descriptions = {
                    'Playing Cards': 'Learn card game vocabulary & competitive conversation',
                    'Card Game Terms': 'Master card-related expressions and game rules',
                    'Hello and Goodbye': 'Essential greetings for family interactions',
                    'Food Names': 'Albanian cuisine and dining vocabulary',
                    'Home & Rooms': 'Navigate household conversations confidently',
                    'Daily Activities': 'Express daily routines and schedules',
                    'Expressing Opinions': 'Share thoughts and preferences naturally',
                    'Emotions & Feelings': 'Communicate emotions in family settings'
                };
                
                for (const [key, desc] of Object.entries(descriptions)) {
                    if (name.toLowerCase().includes(key.toLowerCase())) {
                        return desc;
                    }
                }
                return 'Essential Albanian phrases for family integration';
            };
            
            const getTopicGrammar = (name) => {
                const grammar = {
                    'Playing Cards': 'Verb conjugation: -oj verbs (luaj, fitoj)',
                    'Food Names': 'Food-related verbs & expressions',
                    'Hello and Goodbye': 'Formal vs informal greetings',
                    'Daily Activities': 'Present tense daily routine verbs',
                    'Expressing Opinions': 'Opinion formation & agreement'
                };
                
                for (const [key, gram] of Object.entries(grammar)) {
                    if (name.toLowerCase().includes(key.toLowerCase())) {
                        return gram;
                    }
                }
                return 'Essential grammar patterns';
            };
            
            const handleContinue = () => {
                const lastTopic = localStorage.getItem('lastTopic');
                const lastLesson = localStorage.getItem('lastLesson');
                
                if (lastTopic && appData.topics.find(t => t.id === lastTopic)) {
                    setCurrentTopic(appData.topics.find(t => t.id === lastTopic));
                    setCurrentView('lesson');
                } else {
                    setCurrentView('guided');
                }
            };
            
            const startTopic = (topic) => {
                setCurrentTopic(topic);
                setCurrentView('lesson');
                localStorage.setItem('lastTopic', topic.id);
            };
            
            const goHome = () => {
                setCurrentView('home');
                setCurrentTopic(null);
                setCurrentLesson(null);
            };
            
            return (
                <div className="app-container">
                    {currentView !== 'home' && (
                        <nav className="nav-bar">
                            <button className="nav-back" onClick={goHome}>
                                ← Back to Home
                            </button>
                            <div className="nav-title">
                                {currentView === 'guided' && 'Choose Your Topic'}
                                {currentView === 'solo' && 'Solo Practice'}
                                {currentView === 'lesson' && currentTopic?.name}
                            </div>
                            <div className="nav-progress">
                                {Math.round((appData.learnedCount / appData.totalPhrases) * 100) || 0}% Complete
                            </div>
                        </nav>
                    )}
                    
                    {currentView === 'home' && (
                        <HomePage 
                            appData={appData}
                            onContinue={handleContinue}
                            onNavigate={setCurrentView}
                            loading={loading}
                        />
                    )}
                    
                    {currentView === 'guided' && (
                        <TopicSelection 
                            topics={appData.topics}
                            onStartTopic={startTopic}
                            userProgress={appData.userProgress}
                        />
                    )}
                    
                    {currentView === 'solo' && (
                        <SoloPractice 
                            topics={appData.topics}
                            appData={appData}
                            saveProgress={saveUserProgress}
                        />
                    )}
                    
                    {currentView === 'lesson' && currentTopic && (
                        <TopicLesson 
                            topic={currentTopic}
                            appData={appData}
                            saveProgress={saveUserProgress}
                            onComplete={() => setCurrentView('guided')}
                        />
                    )}
                </div>
            );
        };
        
        // HomePage Component
        const HomePage = ({ appData, onContinue, onNavigate, loading }) => {
            const hasProgress = appData.learnedCount > 0;
            const lastTopic = localStorage.getItem('lastTopic');
            const topicName = lastTopic ? 
                appData.topics.find(t => t.id === lastTopic)?.name || 'Your Learning' : 
                'Your Learning';
            
            return (
                <div className="dashboard fade-in">
                    <div className="app-header">
                        <h1 className="app-title">🇦🇱 Learn Albanian</h1>
                        <p className="app-subtitle">Master Kosovo Albanian with Cultural Context</p>
                        <p className="app-tagline">Real family integration through language</p>
                    </div>
                    
                    <div className="continue-section">
                        <button 
                            className="continue-button"
                            onClick={onContinue}
                            disabled={loading}
                        >
                            {hasProgress ? (
                                <>
                                    <div>CONTINUE</div>
                                    <div style={{fontSize: '0.8em', opacity: 0.9, marginTop: '5px'}}>
                                        {topicName}
                                    </div>
                                </>
                            ) : (
                                'START LEARNING'
                            )}
                        </button>
                    </div>
                    
                    <div className="learning-paths">
                        <div className="path-card" onClick={() => onNavigate('guided')}>
                            <span className="path-icon">🎯</span>
                            <h3 className="path-title">Guided Practice</h3>
                            <p className="path-description">
                                Follow structured lessons by real-life topics like playing cards, family dinners, and coffee conversations
                            </p>
                        </div>
                        
                        <div className="path-card" onClick={() => onNavigate('solo')}>
                            <span className="path-icon">🎲</span>
                            <h3 className="path-title">Solo Practice</h3>
                            <p className="path-description">
                                Choose your own topics and pace with flashcards, vocabulary, and pronunciation practice
                            </p>
                        </div>
                    </div>
                    
                    <div className="quick-stats">
                        <div className="stats-grid">
                            <div className="stat-item">
                                <span className="stat-number">{appData.totalPhrases}</span>
                                <span className="stat-label">Albanian Phrases</span>
                            </div>
                            <div className="stat-item">
                                <span className="stat-number">{appData.learnedCount}</span>
                                <span className="stat-label">Learned</span>
                            </div>
                            <div className="stat-item">
                                <span className="stat-number">{appData.topics.length}</span>
                                <span className="stat-label">Topics</span>
                            </div>
                            <div className="stat-item">
                                <span className="stat-number">
                                    {Math.round((appData.learnedCount / appData.totalPhrases) * 100) || 0}%
                                </span>
                                <span className="stat-label">Progress</span>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };
        
        // TopicSelection Component  
        const TopicSelection = ({ topics, onStartTopic, userProgress }) => {
            return (
                <div className="topic-selection fade-in">
                    <div className="topic-header">
                        <h2 className="topic-title">Guided Practice</h2>
                        <p className="topic-subtitle">Learn Albanian through real-life family situations</p>
                    </div>
                    
                    <div className="topics-grid">
                        {topics.slice(0, 8).map(topic => (
                            <TopicCard 
                                key={topic.id}
                                topic={topic}
                                onStart={() => onStartTopic(topic)}
                                progress={userProgress[topic.id] || 0}
                            />
                        ))}
                    </div>
                </div>
            );
        };
        
        // TopicCard Component
        const TopicCard = ({ topic, onStart, progress }) => {
            return (
                <div className="topic-card">
                    <div className="topic-card-header">
                        <span className="topic-emoji">{topic.icon}</span>
                        <h3 className="topic-card-title">{topic.name}</h3>
                    </div>
                    
                    <p className="topic-description">{topic.description}</p>
                    
                    <div className="topic-stats">
                        <span>{topic.count} phrases</span>
                        <span>{progress}% complete</span>
                    </div>
                    
                    <div className="topic-grammar">
                        Grammar: {topic.grammar}
                    </div>
                    
                    <button className="start-topic-btn" onClick={onStart}>
                        Start Topic
                    </button>
                </div>
            );
        };
        
        // TopicLesson Component
        const TopicLesson = ({ topic, appData, saveProgress, onComplete }) => {
            const [currentStep, setCurrentStep] = useState('theory');
            const [stepProgress, setStepProgress] = useState(0);
            const lessonSteps = ['theory', 'vocabulary', 'verbs', 'practice'];
            const currentStepIndex = lessonSteps.indexOf(currentStep);
            const progressPercentage = ((currentStepIndex + 1) / lessonSteps.length) * 100;
            
            // Scroll to top when step changes
            useEffect(() => {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }, [currentStep]);
            
            const nextStep = () => {
                const nextIndex = currentStepIndex + 1;
                if (nextIndex < lessonSteps.length) {
                    setCurrentStep(lessonSteps[nextIndex]);
                } else {
                    onComplete();
                }
            };
            
            const prevStep = () => {
                const prevIndex = currentStepIndex - 1;
                if (prevIndex >= 0) {
                    setCurrentStep(lessonSteps[prevIndex]);
                }
            };
            
            return (
                <div className="topic-lesson fade-in">
                    <div className="lesson-header">
                        <div className="lesson-title-section">
                            <h2>{topic.icon} {topic.name}</h2>
                            <p className="lesson-subtitle">
                                Step {currentStepIndex + 1} of {lessonSteps.length}: {currentStep.charAt(0).toUpperCase() + currentStep.slice(1)}
                            </p>
                        </div>
                    </div>
                    
                    <div className="lesson-progress">
                        <div className="progress-bar">
                            <div 
                                className="progress-fill" 
                                style={{ width: progressPercentage + '%' }}
                            ></div>
                        </div>
                        <div className="progress-steps">
                            {lessonSteps.map((step, index) => (
                                <div 
                                    key={step}
                                    className={`progress-step ${index < currentStepIndex ? 'completed' : ''} ${index === currentStepIndex ? 'active' : ''}`}
                                >
                                    {step.charAt(0).toUpperCase() + step.slice(1)}
                                </div>
                            ))}
                        </div>
                    </div>
                    
                    {currentStep === 'theory' && (
                        <TheorySection topic={topic} onNext={nextStep} />
                    )}
                    
                    {currentStep === 'vocabulary' && (
                        <VocabularySection topic={topic} onNext={nextStep} onPrev={prevStep} />
                    )}
                    
                    {currentStep === 'verbs' && (
                        <VerbSection topic={topic} onNext={nextStep} onPrev={prevStep} />
                    )}
                    
                    {currentStep === 'practice' && (
                        <PracticeSection 
                            topic={topic} 
                            onNext={nextStep} 
                            onPrev={prevStep}
                            saveProgress={saveProgress}
                            totalPhrases={appData.totalPhrases}
                        />
                    )}
                </div>
            );
        };
        
        // TheorySection Component
        const TheorySection = ({ topic, onNext }) => {
            const getTheoryContent = (topicName) => {
                const theories = {
                    'Playing Cards': {
                        cultural: "In Kosovo Albanian families, card games are powerful social bonding activities. They're not just about winning - they create opportunities for conversation, teach children counting and strategy, and strengthen family relationships. Common expressions of encouragement and friendly competition help build linguistic confidence.",
                        grammar: "The -oj verb pattern is essential for activities: luaj (to play), fitoj (to win), humbas (to lose). These verbs conjugate regularly: luaj → luaj, luan, luajmë, luani, luajnë.",
                        examples: [
                            { albanian: "Luaj kartë me familjen", english: "I play cards with the family" },
                            { albanian: "Ti fiton shpesh", english: "You win often" },
                            { albanian: "Ne luajmë çdo mbrëmje", english: "We play every evening" }
                        ]
                    },
                    'Game Conversation': {
                        cultural: "Card games in Albanian families are deeply social experiences that go beyond simple competition. They're evening rituals where multiple generations gather, stories are shared, and relationships are strengthened. The language used is encouraging and inclusive - even when someone loses, the focus is on 'lojë e mirë' (good game) and 'mirë luajt' (well played). Players take turns being the dealer ('Unë do të ndaj të parët' - I'll deal first), and there's a strong emphasis on fairness and sportsmanship. These games teach children patience, strategy, and most importantly, how to interact respectfully with family members of all ages.",
                        grammar: "Card game verbs follow key patterns: luaj (to play), fitoj (to win), ndaj (to deal/distribute), kaloj (to pass). The verb 'luaj' is irregular: luaj, luan, luajmë, luani, luajnë. Game flow uses present tense for immediate actions ('Unë kaloj' - I pass) and future for intentions ('do të luajmë përsëri' - want to play again). Polite expressions use imperative forms softened with courtesy markers.",
                        examples: [
                            { albanian: "Të gjithë gati?", english: "Everyone ready?" },
                            { albanian: "Është radha jote", english: "It's your turn" },
                            { albanian: "Dorë e mirë!", english: "Nice hand!" },
                            { albanian: "Lojë e mirë", english: "Good game" },
                            { albanian: "Mirë luajt", english: "Well played" }
                        ]
                    },
                    'Hello and Goodbye': {
                        cultural: "Albanian greetings are deeply rooted in respect, hospitality, and family connection. In Kosovo Albanian culture, greetings aren't just polite formalities - they're genuine inquiries about well-being, family health, and life circumstances. The time of day matters greatly: 'Mirëmëngjes' (good morning) until 11 AM, 'Mirëdita' (good day) until evening, and 'Mirëmbrëma' (good evening) after sunset. When meeting family for the first time, longer greetings show respect and interest. 'Ndihuni si në shtëpi' (make yourself at home) demonstrates the Albanian principle of treating guests like family.",
                        grammar: "Albanian greetings use formal vs informal patterns. 'Si je?' (how are you - informal) vs 'Si jeni?' (formal/plural). Response patterns include 'Jam mirë' (I'm well) + reciprocal question. Time expressions like 'këtë mëngjes' (this morning), 'së fundmi' (recently) are essential for natural conversation flow. Farewell phrases literally translate to wishes for well-being: 'Mirupafshim' means 'see you well'.",
                        examples: [
                            { albanian: "Mirëmëngjes, si jeni?", english: "Good morning, how are you?" },
                            { albanian: "Ndihuni si në shtëpi", english: "Make yourself at home" },
                            { albanian: "Këtë mëngjes jam zgjuar herët", english: "This morning I woke up early" },
                            { albanian: "Mirupafshim, shihemi së shpejti", english: "Goodbye, see you soon" },
                            { albanian: "Jo shumë kohë më parë", english: "Not long ago" }
                        ]
                    },
                    'Card Game Terms': {
                        cultural: "Card games in Albanian culture have specific terminology that shows your familiarity with family traditions. Knowing when to say 'unë përkul' (I fold) vs 'kush do të luajë letrat?' (who wants to play cards?) demonstrates social awareness. Card games often involve multiple generations, so using proper terminology shows respect for elders and inclusion of younger family members. The phrase 'të gjithë gati?' (everyone ready?) is essential for ensuring all players feel included before starting.",
                        grammar: "Card game vocabulary uses specific verb forms: 'luaj' (to play), 'përkul' (to fold), 'ndaj' (to deal). Questions often use 'kush' (who) + verb structure. Numbers and counting are integrated: 'një, dy, tre' for card values. Present tense dominates for immediate game actions, with future tense for planning next moves.",
                        examples: [
                            { albanian: "Kush do të luajë letrat?", english: "Who wants to play cards?" },
                            { albanian: "Unë përkul", english: "I fold" },
                            { albanian: "Të gjithë gati?", english: "Everyone ready?" },
                            { albanian: "Deka është e përzier", english: "The deck is shuffled" },
                            { albanian: "Kjo është interesante", english: "This is interesting" }
                        ]
                    },
                    'Winning & Losing': {
                        cultural: "In Albanian family games, winning and losing are handled with grace and sportsmanship. The concept of 'i pa fat' (unlucky) removes personal blame and maintains family harmony. Winners are modest, losers are gracious. Phrases like 'lojë e mirë' acknowledge everyone's effort. Understanding card hierarchy ('xhak' for jack, 'mbret' for king) shows cultural card game knowledge. The question 'kush është radha?' (who's next?) keeps games flowing smoothly and includes everyone.",
                        grammar: "Win/lose vocabulary centers on 'fitoj' (to win) and 'humbas' (to lose) with emotional modifiers. 'I pa fat' (unlucky) uses adjective agreement. 'Kush është radha?' uses question word + verb structure. Card names are often borrowed but adapted to Albanian phonetics.",
                        examples: [
                            { albanian: "Kjo lojë është e mirë", english: "This game is good" },
                            { albanian: "Jam i pa fat sot", english: "I'm unlucky today" },
                            { albanian: "Xhaku fiton mbi dhjetën", english: "Jack wins over ten" },
                            { albanian: "Kush është radha tani?", english: "Who's next now?" },
                            { albanian: "Kush do të luajë me letra?", english: "Who wants to play with cards?" }
                        ]
                    },
                    'Food Names': {
                        cultural: "Albanian cuisine is central to family life and cultural identity. Meals are communal experiences where multiple generations share stories, discuss daily events, and strengthen family bonds. Traditional dishes like byrek, qofte, and fërgesë carry deep cultural significance. When learning food vocabulary, you're not just memorizing words - you're entering the heart of Albanian hospitality. Knowing food names shows respect for cultural traditions and enables meaningful participation in family meals. The phrase 'hajde të hamë së bashku' (let's eat together) embodies the Albanian spirit of inclusivity and warmth.",
                        grammar: "Food vocabulary uses specific article patterns: masculine food items take 'i' (buka i bardhë - white bread), feminine items take 'e' (mishi e kuq - red meat). Quantity expressions use 'pak' (little), 'shumë' (much), 'mjaft' (enough). Food preparation verbs follow regular conjugation patterns: gatuaj (to cook), përgatis (to prepare), shërben (to serve). Taste descriptions use adjective agreement with the food item's gender.",
                        examples: [
                            { albanian: "Buka është e freskët", english: "The bread is fresh" },
                            { albanian: "A do pak mish?", english: "Do you want some meat?" },
                            { albanian: "Mamaja gatuan byrek", english: "Mom is cooking byrek" },
                            { albanian: "Perime të freskëta janë të shëndetshme", english: "Fresh vegetables are healthy" },
                            { albanian: "Hajde të hamë së bashku", english: "Let's eat together" }
                        ]
                    },
                    'Home & Rooms': {
                        cultural: "The Albanian home is a sacred space where family honor, hospitality, and traditions are maintained. Each room has specific cultural significance - the living room (dhoma e ndenjes) is where guests are welcomed with coffee and conversation, the kitchen (kuzhina) is the heart of family activity where meals bring everyone together, and bedrooms are private family spaces. Understanding room vocabulary helps you navigate household dynamics respectfully. Phrases like 'kjo është dhoma ime' (this is my room) or 'kuzhina është e madhe' (the kitchen is big) show your integration into family spatial awareness.",
                        grammar: "Room vocabulary uses definite articles with location: 'në kuzhinë' (in the kitchen), 'te dhoma' (at the room). Possession is expressed with pronouns: 'dhoma ime' (my room), 'shtëpia jonë' (our house). Prepositions of place are crucial: 'mbi' (above), 'nën' (under), 'pranë' (next to). Room descriptions use adjective-noun agreement patterns.",
                        examples: [
                            { albanian: "Kuzhina është e madhe", english: "The kitchen is big" },
                            { albanian: "Dhoma ime është lart", english: "My room is upstairs" },
                            { albanian: "Ne hamë në sufrageri", english: "We eat in the dining room" },
                            { albanian: "Banjo është pranë dhomës", english: "The bathroom is next to the room" },
                            { albanian: "Kjo shtëpi është e bukur", english: "This house is beautiful" }
                        ]
                    },
                    'Daily Activities': {
                        cultural: "Daily routines in Albanian families follow traditional patterns that emphasize family connection and respect for elders. Morning activities begin with coffee (kafe) and family check-ins, work and school responsibilities come next, and evenings center around shared meals and conversation. Weekend routines often include extended family visits and cultural activities. Learning daily activity vocabulary helps you participate in family scheduling discussions and shows respect for household rhythms. The phrase 'çfarë po bën?' (what are you doing?) is a common way family members connect throughout the day.",
                        grammar: "Daily activity verbs predominantly use present tense for current actions: 'po lexoj' (I'm reading), 'po punoj' (I'm working). Time expressions are essential: 'në mëngjes' (in the morning), 'pasdite' (afternoon), 'mbrëmje' (evening). Frequency adverbs modify daily verbs: 'gjithmonë' (always), 'shpesh' (often), 'ndonjëherë' (sometimes). Question formation for activities uses 'çfarë' (what) + present progressive.",
                        examples: [
                            { albanian: "Çfarë po bën tani?", english: "What are you doing now?" },
                            { albanian: "Unë punoj në mëngjes", english: "I work in the morning" },
                            { albanian: "Ajo lexon çdo ditë", english: "She reads every day" },
                            { albanian: "Ne hamë në orën tetë", english: "We eat at eight o'clock" },
                            { albanian: "Pasdite shoh televizor", english: "In the afternoon I watch TV" }
                        ]
                    },
                    'Expressing Opinions': {
                        cultural: "In Albanian families, expressing opinions respectfully is a valued skill that demonstrates maturity and family integration. Opinions are shared through discussion, not confrontation. Elder opinions are given special respect, while younger family members are encouraged to express thoughtful viewpoints. Learning to express preferences, agreements, and respectful disagreements shows cultural understanding. Phrases like 'mendoj se' (I think that) and 'jam dakord' (I agree) facilitate meaningful family discussions. Cultural topics like food preferences, holiday plans, and family decisions are common opinion-sharing contexts.",
                        grammar: "Opinion expressions use 'mendoj se' (I think that) + subjunctive clause. Agreement patterns include 'jam dakord' (I agree) with optional 'me ty/ju' (with you). Preference expressions use 'më pëlqen' (I like) with varying objects. Degrees of certainty are expressed through modal verbs: 'besoj' (I believe), 'mendoj' (I think), 'jam i sigurt' (I'm sure). Opinion questions use 'si mendon?' (what do you think?).",
                        examples: [
                            { albanian: "Mendoj se kjo është e mirë", english: "I think this is good" },
                            { albanian: "Jam dakord me ty", english: "I agree with you" },
                            { albanian: "Më pëlqen ky film", english: "I like this movie" },
                            { albanian: "Si mendon për këtë ide?", english: "What do you think about this idea?" },
                            { albanian: "Besoj se është e drejtë", english: "I believe it's right" }
                        ]
                    },
                    'Emotions & Feelings': {
                        cultural: "Emotional expression in Albanian families balances authenticity with respect for family harmony. Positive emotions like happiness (gëzim) and excitement (entuziazëm) are shared openly to strengthen family bonds. Difficult emotions like sadness (trishtim) or worry (shqetësim) are acknowledged with family support. Albanian culture values emotional honesty while maintaining family stability. Learning emotion vocabulary helps you participate in family emotional support systems and express your feelings appropriately. The phrase 'si ndihesh?' (how do you feel?) shows genuine care and family connection.",
                        grammar: "Emotion vocabulary uses 'ndihem' (I feel) + adjective: 'ndihem mirë' (I feel good). Emotional states can be temporary 'jam i lumtur' (I am happy) or characteristic 'jam person i gëzuar' (I am a happy person). Emotional questions use 'si ndihesh?' (how do you feel?) or 'çfarë të ka ndodhur?' (what happened to you?). Emotion intensity is expressed through adverbs: 'shumë' (very), 'paksa' (a bit), 'jashtëzakonisht' (extremely).",
                        examples: [
                            { albanian: "Si ndihesh sot?", english: "How do you feel today?" },
                            { albanian: "Jam shumë i lumtur", english: "I am very happy" },
                            { albanian: "Ajo duket e trishtuar", english: "She looks sad" },
                            { albanian: "Ndihem pak i lodhur", english: "I feel a bit tired" },
                            { albanian: "Jemi të gëzuar për ty", english: "We are happy for you" }
                        ]
                    }
                };
                
                return theories[topicName] || {
                    cultural: "This topic focuses on essential Albanian family communication patterns and cultural context that will help you integrate naturally into conversations.",
                    grammar: "Key grammatical structures and verb patterns that form the foundation for natural conversation in this context.",
                    examples: [
                        { albanian: "Example phrase", english: "English translation" }
                    ]
                };
            };
            
            const theory = getTheoryContent(topic.name);
            
            return (
                <div className="theory-section">
                    <div className="cultural-context">
                        <h3>Cultural Context</h3>
                        <p>{theory.cultural}</p>
                    </div>
                    
                    <div className="grammar-focus">
                        <h3>Grammar Focus</h3>
                        <p>{theory.grammar}</p>
                        <div className="grammar-examples">
                            {theory.examples.map((example, index) => (
                                <div key={index} className="example-sentence">
                                    <span style={{fontWeight: 'bold', color: '#2563eb'}}>
                                        {example.albanian}
                                    </span>
                                    <span style={{color: '#64748b'}}>
                                        {example.english}
                                    </span>
                                </div>
                            ))}
                        </div>
                    </div>
                    
                    <div className="lesson-preview">
                        <h3>What You'll Learn</h3>
                        <ul>
                            <li>{topic.count} essential phrases</li>
                            <li>Key verb conjugations</li>
                            <li>Cultural conversation patterns</li>
                            <li>Multiple exercise types</li>
                        </ul>
                    </div>
                    
                    <div style={{textAlign: 'center', marginTop: '40px'}}>
                        <button className="btn btn-primary" onClick={onNext}>
                            Start Learning Vocabulary →
                        </button>
                    </div>
                </div>
            );
        };
        
        // VocabularySection Component
        const VocabularySection = ({ topic, onNext, onPrev }) => {
            const [vocabularyData, setVocabularyData] = useState([]);
            const [loading, setLoading] = useState(true);
            const [currentWordIndex, setCurrentWordIndex] = useState(0);
            const [showPronunciation, setShowPronunciation] = useState({});
            
            useEffect(() => {
                loadVocabulary();
            }, [topic.name]);
            
            const loadVocabulary = async () => {
                setLoading(true);
                try {
                    const response = await fetch(`/api/vocabulary/${encodeURIComponent(topic.name)}`);
                    const data = await response.json();
                    
                    // Transform database data to include pronunciation and usage hints
                    const transformedData = data.map((item, index) => ({
                        english: item.english_phrase,
                        albanian: item.target_phrase,
                        pronunciation: generatePronunciation(item.target_phrase),
                        usage: item.cultural_context || `Essential ${topic.name.toLowerCase()} phrase`,
                        example: `${item.target_phrase} (${item.english_phrase})`
                    }));
                    
                    setVocabularyData(transformedData.slice(0, 15)); // Show first 15 words
                } catch (error) {
                    console.error('Failed to load vocabulary:', error);
                    // Show error message instead of falling back
                    setVocabularyData([{
                        english: 'Error loading vocabulary',
                        albanian: 'Gabim në ngarkim',
                        pronunciation: 'gah-BEEM nuh ngar-KEEM',
                        usage: 'Please check your connection and try again',
                        example: 'Unable to connect to database'
                    }]);
                } finally {
                    setLoading(false);
                }
            };
            
            // Helper function to generate basic pronunciation guides
            const generatePronunciation = (albanian) => {
                // Simple pronunciation mapping for Albanian sounds
                return albanian
                    .replace(/ë/g, 'uh')
                    .replace(/ç/g, 'ch')
                    .replace(/zh/g, 'zh')
                    .replace(/sh/g, 'sh')
                    .replace(/dh/g, 'dh')
                    .replace(/th/g, 'th')
                    .replace(/nj/g, 'ny')
                    .replace(/ll/g, 'l')
                    .replace(/rr/g, 'r')
                    .toUpperCase();
            };
            
            const togglePronunciation = (index) => {
                setShowPronunciation(prev => ({
                    ...prev,
                    [index]: !prev[index]
                }));
            };
            
            if (loading) {
                return (
                    <div style={{textAlign: 'center', padding: '100px 20px'}}>
                        <div className="spinner"></div>
                        <p>Loading vocabulary...</p>
                    </div>
                );
            }
            
            const vocabularyToShow = vocabularyData;
            
            return (
                <div className="vocabulary-section">
                    <div style={{maxWidth: '800px', margin: '0 auto'}}>
                        <div style={{textAlign: 'center', marginBottom: '40px'}}>
                            <h3 style={{fontSize: '2em', marginBottom: '15px', color: '#0f172a'}}>
                                Essential Vocabulary
                            </h3>
                            <p style={{fontSize: '1.2em', color: '#64748b'}}>
                                Master these key words for {topic.name.toLowerCase()}
                            </p>
                        </div>
                        
                        <div style={{display: 'grid', gap: '20px', marginBottom: '40px'}}>
                            {vocabularyToShow.map((word, index) => (
                                <div key={index} style={{
                                    background: index % 2 === 0 ? '#f8faff' : '#ffffff',
                                    border: '2px solid #e2e8f0',
                                    borderRadius: '15px',
                                    padding: '25px',
                                    transition: 'all 0.3s ease'
                                }}>
                                    <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '15px'}}>
                                        <div>
                                            <div style={{fontSize: '1.5em', fontWeight: '600', color: '#0f172a', marginBottom: '5px'}}>
                                                {word.english}
                                            </div>
                                            <div style={{fontSize: '2em', fontWeight: 'bold', color: '#2563eb'}}>
                                                {word.albanian}
                                            </div>
                                        </div>
                                        <button 
                                            className="btn btn-secondary"
                                            style={{padding: '8px 16px', fontSize: '0.9em'}}
                                            onClick={() => togglePronunciation(index)}
                                        >
                                            🔊 Pronunciation
                                        </button>
                                    </div>
                                    
                                    {showPronunciation[index] && (
                                        <div style={{
                                            background: '#2563eb',
                                            color: 'white',
                                            padding: '15px',
                                            borderRadius: '10px',
                                            marginBottom: '15px',
                                            fontStyle: 'italic',
                                            fontSize: '1.2em'
                                        }}>
                                            /{word.pronunciation}/
                                        </div>
                                    )}
                                    
                                    <div style={{
                                        background: '#f0fdf4',
                                        borderLeft: '4px solid #10b981',
                                        padding: '15px',
                                        borderRadius: '8px',
                                        marginBottom: '10px'
                                    }}>
                                        <strong style={{color: '#166534'}}>Usage:</strong> {word.usage}
                                    </div>
                                    
                                    <div style={{
                                        fontStyle: 'italic',
                                        color: '#64748b',
                                        fontSize: '1.1em'
                                    }}>
                                        <strong>Example:</strong> {word.example}
                                    </div>
                                </div>
                            ))}
                        </div>
                        
                        <div style={{
                            background: '#fef9e7',
                            borderLeft: '5px solid #f59e0b',
                            padding: '20px',
                            borderRadius: '10px',
                            marginBottom: '30px'
                        }}>
                            <p style={{color: '#92400e', fontWeight: '600', marginBottom: '10px'}}>
                                💡 Study Tip
                            </p>
                            <p style={{color: '#78350f'}}>
                                Practice these words by using them in context during family card games. 
                                Albanian families appreciate when you make an effort to use the correct terminology!
                            </p>
                        </div>
                        
                        <div style={{display: 'flex', justifyContent: 'center', gap: '20px'}}>
                            <button className="btn btn-outline" onClick={onPrev}>
                                ← Back to Theory
                            </button>
                            <button className="btn btn-primary" onClick={onNext}>
                                Continue to Verbs →
                            </button>
                        </div>
                    </div>
                </div>
            );
        };
        
        // Dynamic VerbSection Component - replaces hardcoded conjugations with API calls
        const VerbSection = ({ topic, onNext, onPrev }) => {
            const [verbData, setVerbData] = useState([]);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);

            useEffect(() => {
                loadVerbsForTopic();
            }, [topic]);

            const loadVerbsForTopic = async () => {
                setLoading(true);
                setError(null);
                
                try {
                    // Get verbs from grammar API
                    const response = await fetch('/api/grammar/verbs?language=gheg-al&limit=20');
                    const data = await response.json();
                    
                    if (data.success && data.verbs) {
                        // Select 3-4 most relevant verbs for the topic
                        const topicVerbs = selectVerbsForTopic(data.verbs, topic.name);
                        setVerbData(topicVerbs);
                    } else {
                        throw new Error('Failed to load verb data');
                    }
                    
                } catch (error) {
                    console.error('Error loading verbs for topic:', error);
                    setError(error.message);
                    // Fallback to basic verb data
                    setVerbData(getFallbackVerbData(topic.name));
                } finally {
                    setLoading(false);
                }
            };

            const selectVerbsForTopic = (allVerbs, topicName) => {
                // Map topics to relevant verbs based on usage context
                const topicVerbMap = {
                    'Game Conversation': ['luaj', 'fitoj', 'humbas'],
                    'Playing Cards': ['luaj', 'fitoj', 'ndaj'],
                    'Food Names': ['ha', 'gatuaj', 'shërben'],
                    'Home & Rooms': ['jetoj', 'shkoj', 'qëndroj'],
                    'Daily Activities': ['punoj', 'lexoj', 'fle'],
                    'Expressing Opinions': ['mendoj', 'besoj', 'preferoj'],
                    'Emotions & Feelings': ['ndihem', 'jam', 'dukem'],
                    'Hello and Goodbye': ['them', 'vij', 'shkoj'],
                    'Card Game Terms': ['filloj', 'ndal', 'dua'],
                    'Winning & Losing': ['fitoj', 'humbas', 'provoj']
                };

                const preferredVerbs = topicVerbMap[topicName] || ['jam', 'ha', 'shkoj'];
                
                // Find verbs that match the topic
                const selectedVerbs = [];
                
                for (const verbInfinitive of preferredVerbs) {
                    const verb = allVerbs.find(v => v.infinitive === verbInfinitive);
                    if (verb) {
                        selectedVerbs.push(transformVerbForDisplay(verb));
                    }
                }
                
                // If we don't have enough verbs, add some high-frequency ones
                while (selectedVerbs.length < 3 && selectedVerbs.length < allVerbs.length) {
                    const additionalVerb = allVerbs
                        .filter(v => !selectedVerbs.some(sv => sv.infinitive === v.infinitive))
                        .sort((a, b) => (a.frequency_rank || 100) - (b.frequency_rank || 100))[0];
                    
                    if (additionalVerb) {
                        selectedVerbs.push(transformVerbForDisplay(additionalVerb));
                    } else {
                        break;
                    }
                }
                
                return selectedVerbs.slice(0, 4); // Max 4 verbs per topic
            };

            const transformVerbForDisplay = (verb) => {
                // Transform API verb data to match the expected component format
                const presentConjugations = verb.conjugations?.present || {};
                
                return {
                    infinitive: verb.infinitive,
                    english: verb.english_translation,
                    type: verb.pattern_name || 'unknown pattern',
                    conjugations: {
                        'unë': { 
                            form: presentConjugations['unë'] || verb.infinitive, 
                            english: `I ${verb.english_translation.replace('to ', '')}` 
                        },
                        'ti': { 
                            form: presentConjugations['ti'] || verb.infinitive, 
                            english: `you ${verb.english_translation.replace('to ', '')}` 
                        },
                        'ai/ajo': { 
                            form: presentConjugations['ai/ajo'] || verb.infinitive, 
                            english: `he/she ${verb.english_translation.replace('to ', '')}s` 
                        },
                        'ne': { 
                            form: presentConjugations['ne'] || verb.infinitive, 
                            english: `we ${verb.english_translation.replace('to ', '')}` 
                        },
                        'ju': { 
                            form: presentConjugations['ju'] || verb.infinitive, 
                            english: `you (plural) ${verb.english_translation.replace('to ', '')}` 
                        },
                        'ata/ato': { 
                            form: presentConjugations['ata/ato'] || verb.infinitive, 
                            english: `they ${verb.english_translation.replace('to ', '')}` 
                        }
                    },
                    examples: verb.usage_examples || generateBasicExamples(verb),
                    cultural_notes: verb.cultural_notes
                };
            };

            const generateBasicExamples = (verb) => {
                // Generate basic examples when none are provided
                const presentForms = verb.conjugations?.present || {};
                const examples = [];
                
                if (presentForms['unë']) {
                    examples.push({
                        albanian: `Unë ${presentForms['unë']} çdo ditë`,
                        english: `I ${verb.english_translation.replace('to ', '')} every day`
                    });
                }
                
                if (presentForms['ne']) {
                    examples.push({
                        albanian: `Ne ${presentForms['ne']} bashkë`,
                        english: `We ${verb.english_translation.replace('to ', '')} together`
                    });
                }
                
                return examples;
            };

            const getFallbackVerbData = (topicName) => {
                // Fallback verb data when API is not available
                return [
                    {
                        infinitive: 'jam',
                        english: 'to be',
                        type: 'irregular',
                        conjugations: {
                            'unë': { form: 'jam', english: 'I am' },
                            'ti': { form: 'je', english: 'you are' },
                            'ai/ajo': { form: 'është', english: 'he/she is' },
                            'ne': { form: 'jemi', english: 'we are' },
                            'ju': { form: 'jeni', english: 'you (plural) are' },
                            'ata/ato': { form: 'janë', english: 'they are' }
                        },
                        examples: [
                            { albanian: 'Unë jam këtu', english: 'I am here' },
                            { albanian: 'Ti je i mirë', english: 'You are good' }
                        ]
                    }
                ];
            };

            if (loading) {
                return (
                    <div className="verb-section loading">
                        <div className="section-header">
                            <h3>📖 Albanian Verbs - {topic.name}</h3>
                            <p>Loading verb conjugations...</p>
                        </div>
                        <div className="spinner"></div>
                    </div>
                );
            }

            if (error || !verbData || verbData.length === 0) {
                return (
                    <div className="verb-section error">
                        <div className="section-header">
                            <h3>📖 Albanian Verbs - {topic.name}</h3>
                            <p style={{color: '#e74c3c'}}>
                                {error ? `Error: ${error}` : 'No verbs available for this topic'}
                            </p>
                        </div>
                        <div className="navigation-buttons">
                            <button className="btn btn-secondary" onClick={onPrev}>
                                ← Previous Section
                            </button>
                            <button className="btn btn-primary" onClick={onNext}>
                                Continue to Practice →
                            </button>
                        </div>
                    </div>
                );
            }

            return (
                <div className="verb-section">
                    <div style={{maxWidth: '900px', margin: '0 auto'}}>
                        <div style={{textAlign: 'center', marginBottom: '40px'}}>
                            <h3 style={{fontSize: '2em', marginBottom: '15px', color: '#0f172a'}}>
                                Essential Verbs & Conjugations
                            </h3>
                            <p style={{fontSize: '1.2em', color: '#64748b'}}>
                                Master the verb patterns you'll use in {topic.name.toLowerCase()}
                            </p>
                        </div>
                        
                        {loading && (
                            <div style={{textAlign: 'center', padding: '40px'}}>
                                <div style={{fontSize: '1.2em', color: '#64748b'}}>Loading Albanian verbs...</div>
                            </div>
                        )}
                        
                        {error && (
                            <div style={{textAlign: 'center', padding: '40px', color: '#dc2626'}}>
                                <p>Error loading verbs: {error}</p>
                            </div>
                        )}
                        
                        {!loading && !error && verbData.map((verb, verbIndex) => (
                            <div key={verbIndex} style={{
                                background: '#ffffff',
                                border: '2px solid #e2e8f0',
                                borderRadius: '20px',
                                padding: '30px',
                                marginBottom: '30px',
                                boxShadow: '0 4px 15px rgba(0,0,0,0.05)'
                            }}>
                                <div style={{display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: '25px'}}>
                                    <div>
                                        <h4 style={{fontSize: '2em', color: '#2563eb', fontWeight: 'bold', marginBottom: '5px'}}>
                                            {verb.infinitive}
                                        </h4>
                                        <p style={{fontSize: '1.3em', color: '#0f172a', fontStyle: 'italic'}}>
                                            {verb.english}
                                        </p>
                                    </div>
                                    <div style={{
                                        background: verb.type.includes('irregular') ? '#fef2f2' : '#f0fdf4',
                                        border: `2px solid ${verb.type.includes('irregular') ? '#ef4444' : '#10b981'}`,
                                        color: verb.type.includes('irregular') ? '#dc2626' : '#166534',
                                        padding: '8px 16px',
                                        borderRadius: '20px',
                                        fontSize: '0.9em',
                                        fontWeight: '600'
                                    }}>
                                        {verb.type}
                                    </div>
                                </div>
                                
                                <div className="conjugations-grid">
                                    <div className="conjugation-column">
                                        <div className="conjugation-item">
                                            <div className="person">unë</div>
                                            <div className="form">{verb.conjugations['unë']?.form}</div>
                                            <div className="translation">{verb.conjugations['unë']?.english}</div>
                                        </div>
                                        <div className="conjugation-item">
                                            <div className="person">ti</div>
                                            <div className="form">{verb.conjugations['ti']?.form}</div>
                                            <div className="translation">{verb.conjugations['ti']?.english}</div>
                                        </div>
                                        <div className="conjugation-item">
                                            <div className="person">ai/ajo</div>
                                            <div className="form">{verb.conjugations['ai/ajo']?.form}</div>
                                            <div className="translation">{verb.conjugations['ai/ajo']?.english}</div>
                                        </div>
                                    </div>
                                    <div className="conjugation-column">
                                        <div className="conjugation-item">
                                            <div className="person">ne</div>
                                            <div className="form">{verb.conjugations['ne']?.form}</div>
                                            <div className="translation">{verb.conjugations['ne']?.english}</div>
                                        </div>
                                        <div className="conjugation-item">
                                            <div className="person">ju</div>
                                            <div className="form">{verb.conjugations['ju']?.form}</div>
                                            <div className="translation">{verb.conjugations['ju']?.english}</div>
                                        </div>
                                        <div className="conjugation-item">
                                            <div className="person">ata/ato</div>
                                            <div className="form">{verb.conjugations['ata/ato']?.form}</div>
                                            <div className="translation">{verb.conjugations['ata/ato']?.english}</div>
                                        </div>
                                    </div>
                                </div>
                                
                                {verb.examples && verb.examples.length > 0 && (
                                    <div className="verb-examples">
                                        <h5>Example Sentences:</h5>
                                        {verb.examples.map((example, index) => (
                                            <div key={index} className="example">
                                                <div className="albanian">{example.albanian}</div>
                                                <div className="english">{example.english}</div>
                                            </div>
                                        ))}
                                    </div>
                                )}
                                
                                {verb.cultural_notes && (
                                    <div style={{
                                        background: '#f0fdf4',
                                        borderLeft: '5px solid #10b981',
                                        padding: '15px',
                                        borderRadius: '10px',
                                        marginTop: '20px'
                                    }}>
                                        <p style={{color: '#166534', fontWeight: '600', marginBottom: '5px'}}>
                                            💡 Cultural Context
                                        </p>
                                        <p style={{color: '#14532d', lineHeight: '1.4'}}>
                                            {verb.cultural_notes}
                                        </p>
                                    </div>
                                )}
                            </div>
                        ))}
                        
                        <div style={{display: 'flex', justifyContent: 'center', gap: '20px', marginTop: '40px'}}>
                            <button className="btn btn-secondary" onClick={onPrev}>
                                ← Previous Section  
                            </button>
                            <button className="btn btn-primary" onClick={onNext}>
                                Continue to Practice →
                            </button>
                        </div>
                    </div>
                </div>
            )
        };
        
        // PracticeSection Component
        const PracticeSection = ({ topic, onNext, onPrev, saveProgress, totalPhrases }) => {
            const [currentExercise, setCurrentExercise] = useState(0);
            const [exerciseData, setExerciseData] = useState(null);
            const [loading, setLoading] = useState(false);
            const [userAnswers, setUserAnswers] = useState({});
            const [exerciseScore, setExerciseScore] = useState({ correct: 0, total: 0 });
            
            // Get verb data for topic
            const getVerbData = (topicName) => {
                const verbData = {
                    'Game Conversation': {
                        primaryVerbs: [
                            {
                                infinitive: 'luaj',
                                english: 'to play',
                                type: 'regular (-aj)',
                                conjugations: {
                                    'unë': { form: 'luaj', english: 'I play' },
                                    'ti': { form: 'luan', english: 'you play' },
                                    'ai/ajo': { form: 'luan', english: 'he/she plays' },
                                    'ne': { form: 'luajmë', english: 'we play' },
                                    'ju': { form: 'luani', english: 'you (plural) play' },
                                    'ata/ato': { form: 'luajnë', english: 'they play' }
                                },
                                examples: [
                                    { albanian: 'Luaj me letërkë', english: 'I play with cards' },
                                    { albanian: 'Luajmë së bashku', english: 'We play together' },
                                    { albanian: 'Ti luan shumë mirë', english: 'You play very well' }
                                ]
                            }
                        ],
                        commonPhrases: [
                            { pattern: 'play + game', example: 'Luaj një lojë (I play a game)', usage: 'Starting family game time' },
                            { pattern: 'win + gracefully', example: 'Fitoj me respekt (I win with respect)', usage: 'Good sportsmanship' }
                        ]
                    },
                    'Food Names': {
                        primaryVerbs: [
                            {
                                infinitive: 'ha',
                                english: 'to eat',
                                type: 'irregular',
                                conjugations: {
                                    'unë': { form: 'ha', english: 'I eat' },
                                    'ti': { form: 'ha', english: 'you eat' },
                                    'ai/ajo': { form: 'ha', english: 'he/she eats' },
                                    'ne': { form: 'hamë', english: 'we eat' },
                                    'ju': { form: 'hani', english: 'you (plural) eat' },
                                    'ata/ato': { form: 'hanë', english: 'they eat' }
                                },
                                examples: [
                                    { albanian: 'Unë ha bukë çdo ditë', english: 'I eat bread every day' },
                                    { albanian: 'Ne hamë së bashku', english: 'We eat together' },
                                    { albanian: 'Ajo ha perime të freskëta', english: 'She eats fresh vegetables' }
                                ]
                            },
                            {
                                infinitive: 'gatuaj',
                                english: 'to cook',
                                type: 'regular (-aj)',
                                conjugations: {
                                    'unë': { form: 'gatuaj', english: 'I cook' },
                                    'ti': { form: 'gatuan', english: 'you cook' },
                                    'ai/ajo': { form: 'gatuan', english: 'he/she cooks' },
                                    'ne': { form: 'gatuajmë', english: 'we cook' },
                                    'ju': { form: 'gatuani', english: 'you (plural) cook' },
                                    'ata/ato': { form: 'gatuajnë', english: 'they cook' }
                                },
                                examples: [
                                    { albanian: 'Mamaja gatuan byrek', english: 'Mom cooks byrek' },
                                    { albanian: 'Unë gatuaj mish në furrë', english: 'I cook meat in the oven' },
                                    { albanian: 'Ne gatuajmë së bashku', english: 'We cook together' }
                                ]
                            },
                            {
                                infinitive: 'shërben',
                                english: 'to serve',
                                type: 'regular (-en)',
                                conjugations: {
                                    'unë': { form: 'shërbej', english: 'I serve' },
                                    'ti': { form: 'shërben', english: 'you serve' },
                                    'ai/ajo': { form: 'shërben', english: 'he/she serves' },
                                    'ne': { form: 'shërbejmë', english: 'we serve' },
                                    'ju': { form: 'shërbeni', english: 'you (plural) serve' },
                                    'ata/ato': { form: 'shërbejnë', english: 'they serve' }
                                },
                                examples: [
                                    { albanian: 'Shërbej darkën për familjen', english: 'I serve dinner for the family' },
                                    { albanian: 'Ti shërben mirë miqtë', english: 'You serve guests well' },
                                    { albanian: 'Ata shërbejnë bukë të ngrohtë', english: 'They serve warm bread' }
                                ]
                            }
                        ],
                        commonPhrases: [
                            { pattern: 'invitation + subjunctive', example: 'Hajde të hamë (Let\"s eat)', usage: 'Inviting family to share a meal' },
                            { pattern: 'quantity question', example: 'A do pak mish? (Do you want some meat?)', usage: 'Offering food portions politely' },
                            { pattern: 'taste description', example: 'Është e shijshme (It\"s tasty)', usage: 'Complimenting the cook' }
                        ]
                    },
                    'Home & Rooms': {
                        primaryVerbs: [
                            {
                                infinitive: 'jetoj',
                                english: 'to live',
                                type: 'regular (-oj)',
                                conjugations: {
                                    'unë': { form: 'jetoj', english: 'I live' },
                                    'ti': { form: 'jeton', english: 'you live' },
                                    'ai/ajo': { form: 'jeton', english: 'he/she lives' },
                                    'ne': { form: 'jetojmë', english: 'we live' },
                                    'ju': { form: 'jetoni', english: 'you (plural) live' },
                                    'ata/ato': { form: 'jetojnë', english: 'they live' }
                                },
                                examples: [
                                    { albanian: 'Jetoj në shtëpi të madhe', english: 'I live in a big house' },
                                    { albanian: 'Ne jetojmë së bashku', english: 'We live together' },
                                    { albanian: 'Ajo jeton lart', english: 'She lives upstairs' }
                                ]
                            },
                            {
                                infinitive: 'shkoj',
                                english: 'to go',
                                type: 'irregular',
                                conjugations: {
                                    'unë': { form: 'shkoj', english: 'I go' },
                                    'ti': { form: 'shkon', english: 'you go' },
                                    'ai/ajo': { form: 'shkon', english: 'he/she goes' },
                                    'ne': { form: 'shkojmë', english: 'we go' },
                                    'ju': { form: 'shkoni', english: 'you (plural) go' },
                                    'ata/ato': { form: 'shkojnë', english: 'they go' }
                                },
                                examples: [
                                    { albanian: 'Shkoj në kuzhinë', english: 'I go to the kitchen' },
                                    { albanian: 'Shkojmë në dhomën e ndenjes', english: 'We go to the living room' },
                                    { albanian: 'Ajo shkon lart në dhomë', english: 'She goes upstairs to the room' }
                                ]
                            },
                            {
                                infinitive: 'qëndroj',
                                english: 'to stay',
                                type: 'regular (-oj)',
                                conjugations: {
                                    'unë': { form: 'qëndroj', english: 'I stay' },
                                    'ti': { form: 'qëndron', english: 'you stay' },
                                    'ai/ajo': { form: 'qëndron', english: 'he/she stays' },
                                    'ne': { form: 'qëndrojmë', english: 'we stay' },
                                    'ju': { form: 'qëndroni', english: 'you (plural) stay' },
                                    'ata/ato': { form: 'qëndrojnë', english: 'they stay' }
                                },
                                examples: [
                                    { albanian: 'Qëndroj në dhomën time', english: 'I stay in my room' },
                                    { albanian: 'Ne qëndrojmë në sufrageri', english: 'We stay in the dining room' },
                                    { albanian: 'Ti qëndron këtu sot', english: 'You stay here today' }
                                ]
                            }
                        ],
                        commonPhrases: [
                            { pattern: 'location + definite article', example: 'Në kuzhinë (In the kitchen)', usage: 'Describing where activities happen' },
                            { pattern: 'possession + location', example: 'Dhoma ime është lart (My room is upstairs)', usage: 'Explaining personal space' },
                            { pattern: 'invitation to room', example: 'Ejani në sufrageri (Come to the dining room)', usage: 'Directing family members' }
                        ]
                    },
                    'Daily Activities': {
                        primaryVerbs: [
                            {
                                infinitive: 'punoj',
                                english: 'to work',
                                type: 'regular (-oj)',
                                conjugations: {
                                    'unë': { form: 'punoj', english: 'I work' },
                                    'ti': { form: 'punon', english: 'you work' },
                                    'ai/ajo': { form: 'punon', english: 'he/she works' },
                                    'ne': { form: 'punojmë', english: 'we work' },
                                    'ju': { form: 'punoni', english: 'you (plural) work' },
                                    'ata/ato': { form: 'punojnë', english: 'they work' }
                                },
                                examples: [
                                    { albanian: 'Punoj në mëngjes', english: 'I work in the morning' },
                                    { albanian: 'Ajo punon shumë', english: 'She works a lot' },
                                    { albanian: 'Ne punojmë së bashku', english: 'We work together' }
                                ]
                            },
                            {
                                infinitive: 'lexoj',
                                english: 'to read',
                                type: 'regular (-oj)',
                                conjugations: {
                                    'unë': { form: 'lexoj', english: 'I read' },
                                    'ti': { form: 'lexon', english: 'you read' },
                                    'ai/ajo': { form: 'lexon', english: 'he/she reads' },
                                    'ne': { form: 'lexojmë', english: 'we read' },
                                    'ju': { form: 'lexoni', english: 'you (plural) read' },
                                    'ata/ato': { form: 'lexojnë', english: 'they read' }
                                },
                                examples: [
                                    { albanian: 'Lexoj çdo ditë', english: 'I read every day' },
                                    { albanian: 'Ti lexon libra shqip', english: 'You read Albanian books' },
                                    { albanian: 'Ata lexojnë gazeta', english: 'They read newspapers' }
                                ]
                            },
                            {
                                infinitive: 'fle',
                                english: 'to sleep',
                                type: 'irregular',
                                conjugations: {
                                    'unë': { form: 'fle', english: 'I sleep' },
                                    'ti': { form: 'fle', english: 'you sleep' },
                                    'ai/ajo': { form: 'fle', english: 'he/she sleeps' },
                                    'ne': { form: 'flemë', english: 'we sleep' },
                                    'ju': { form: 'flini', english: 'you (plural) sleep' },
                                    'ata/ato': { form: 'flenë', english: 'they sleep' }
                                },
                                examples: [
                                    { albanian: 'Fle tetë orë', english: 'I sleep eight hours' },
                                    { albanian: 'Ne flemë herët', english: 'We sleep early' },
                                    { albanian: 'Ajo fle mirë', english: 'She sleeps well' }
                                ]
                            }
                        ],
                        commonPhrases: [
                            { pattern: 'activity + time', example: 'Punoj në mëngjes (I work in the morning)', usage: 'Describing daily schedule' },
                            { pattern: 'frequency + activity', example: 'Lexoj çdo ditë (I read every day)', usage: 'Expressing regular habits' },
                            { pattern: 'question about activity', example: 'Çfarë po bën? (What are you doing?)', usage: 'Family check-in conversation' }
                        ]
                    },
                    'Expressing Opinions': {
                        primaryVerbs: [
                            {
                                infinitive: 'mendoj',
                                english: 'to think',
                                type: 'regular (-oj)',
                                conjugations: {
                                    'unë': { form: 'mendoj', english: 'I think' },
                                    'ti': { form: 'mendon', english: 'you think' },
                                    'ai/ajo': { form: 'mendon', english: 'he/she thinks' },
                                    'ne': { form: 'mendojmë', english: 'we think' },
                                    'ju': { form: 'mendoni', english: 'you (plural) think' },
                                    'ata/ato': { form: 'mendojnë', english: 'they think' }
                                },
                                examples: [
                                    { albanian: 'Mendoj se është mirë', english: 'I think it\"s good' },
                                    { albanian: 'Si mendon për këtë?', english: 'What do you think about this?' },
                                    { albanian: 'Ne mendojmë njësoj', english: 'We think the same' }
                                ]
                            },
                            {
                                infinitive: 'besoj',
                                english: 'to believe',
                                type: 'regular (-oj)',
                                conjugations: {
                                    'unë': { form: 'besoj', english: 'I believe' },
                                    'ti': { form: 'beson', english: 'you believe' },
                                    'ai/ajo': { form: 'beson', english: 'he/she believes' },
                                    'ne': { form: 'besojmë', english: 'we believe' },
                                    'ju': { form: 'besoni', english: 'you (plural) believe' },
                                    'ata/ato': { form: 'besojnë', english: 'they believe' }
                                },
                                examples: [
                                    { albanian: 'Besoj se është e drejtë', english: 'I believe it\"s right' },
                                    { albanian: 'Ne besojmë në ty', english: 'We believe in you' },
                                    { albanian: 'Ajo beson në familje', english: 'She believes in family' }
                                ]
                            },
                            {
                                infinitive: 'preferoj',
                                english: 'to prefer',
                                type: 'regular (-oj)',
                                conjugations: {
                                    'unë': { form: 'preferoj', english: 'I prefer' },
                                    'ti': { form: 'preferon', english: 'you prefer' },
                                    'ai/ajo': { form: 'preferon', english: 'he/she prefers' },
                                    'ne': { form: 'preferojmë', english: 'we prefer' },
                                    'ju': { form: 'preferoni', english: 'you (plural) prefer' },
                                    'ata/ato': { form: 'preferojnë', english: 'they prefer' }
                                },
                                examples: [
                                    { albanian: 'Preferoj këtë film', english: 'I prefer this movie' },
                                    { albanian: 'Ti preferon çaj', english: 'You prefer tea' },
                                    { albanian: 'Ata preferojnë shtëpinë', english: 'They prefer the house' }
                                ]
                            }
                        ],
                        commonPhrases: [
                            { pattern: 'opinion + subjunctive', example: 'Mendoj se është mirë (I think it\"s good)', usage: 'Expressing thoughts respectfully' },
                            { pattern: 'agreement expression', example: 'Jam dakord me ty (I agree with you)', usage: 'Showing family unity' },
                            { pattern: 'preference statement', example: 'Më pëlqen kjo (I like this)', usage: 'Expressing personal taste' }
                        ]
                    },
                    'Emotions & Feelings': {
                        primaryVerbs: [
                            {
                                infinitive: 'ndihem',
                                english: 'to feel',
                                type: 'regular (-em)',
                                conjugations: {
                                    'unë': { form: 'ndihem', english: 'I feel' },
                                    'ti': { form: 'ndihesh', english: 'you feel' },
                                    'ai/ajo': { form: 'ndihet', english: 'he/she feels' },
                                    'ne': { form: 'ndihemi', english: 'we feel' },
                                    'ju': { form: 'ndiheni', english: 'you (plural) feel' },
                                    'ata/ato': { form: 'ndihen', english: 'they feel' }
                                },
                                examples: [
                                    { albanian: 'Ndihem mirë sot', english: 'I feel good today' },
                                    { albanian: 'Si ndihesh?', english: 'How do you feel?' },
                                    { albanian: 'Ne ndihemi të lumtur', english: 'We feel happy' }
                                ]
                            },
                            {
                                infinitive: 'jam',
                                english: 'to be',
                                type: 'irregular (copula)',
                                conjugations: {
                                    'unë': { form: 'jam', english: 'I am' },
                                    'ti': { form: 'je', english: 'you are' },
                                    'ai/ajo': { form: 'është', english: 'he/she is' },
                                    'ne': { form: 'jemi', english: 'we are' },
                                    'ju': { form: 'jeni', english: 'you (plural) are' },
                                    'ata/ato': { form: 'janë', english: 'they are' }
                                },
                                examples: [
                                    { albanian: 'Jam i lumtur', english: 'I am happy' },
                                    { albanian: 'Je i trishtuar?', english: 'Are you sad?' },
                                    { albanian: 'Jemi krenarë për ty', english: 'We are proud of you' }
                                ]
                            },
                            {
                                infinitive: 'dukem',
                                english: 'to look/appear',
                                type: 'regular (-em)',
                                conjugations: {
                                    'unë': { form: 'dukem', english: 'I look' },
                                    'ti': { form: 'dukesh', english: 'you look' },
                                    'ai/ajo': { form: 'duket', english: 'he/she looks' },
                                    'ne': { form: 'dukemi', english: 'we look' },
                                    'ju': { form: 'dukeni', english: 'you (plural) look' },
                                    'ata/ato': { form: 'duken', english: 'they look' }
                                },
                                examples: [
                                    { albanian: 'Dukesh i lodhur', english: 'You look tired' },
                                    { albanian: 'Ajo duket e lumtur', english: 'She looks happy' },
                                    { albanian: 'Dukem i shqetësuar', english: 'I look worried' }
                                ]
                            }
                        ],
                        commonPhrases: [
                            { pattern: 'feeling inquiry', example: 'Si ndihesh? (How do you feel?)', usage: 'Showing care for family member' },
                            { pattern: 'emotion + intensifier', example: 'Jam shumë i lumtur (I am very happy)', usage: 'Expressing strong positive feelings' },
                            { pattern: 'observation + emotion', example: 'Dukesh i trishtuar (You look sad)', usage: 'Noticing family member\"s emotional state' }
                        ]
                    },
                    'Hello and Goodbye': {
                        primaryVerbs: [
                            {
                                infinitive: 'them',
                                english: 'to say',
                                type: 'irregular',
                                conjugations: {
                                    'unë': { form: 'them', english: 'I say' },
                                    'ti': { form: 'thua', english: 'you say' },
                                    'ai/ajo': { form: 'thotë', english: 'he/she says' },
                                    'ne': { form: 'themi', english: 'we say' },
                                    'ju': { form: 'thoni', english: 'you (plural) say' },
                                    'ata/ato': { form: 'thonë', english: 'they say' }
                                },
                                examples: [
                                    { albanian: 'Them mirëmëngjes çdo ditë', english: 'I say good morning every day' },
                                    { albanian: 'Ti thua mirupafshim bukur', english: 'You say goodbye nicely' },
                                    { albanian: 'Ne themi faleminderit', english: 'We say thank you' }
                                ]
                            },
                            {
                                infinitive: 'vij',
                                english: 'to come',
                                type: 'irregular',
                                conjugations: {
                                    'unë': { form: 'vij', english: 'I come' },
                                    'ti': { form: 'vjen', english: 'you come' },
                                    'ai/ajo': { form: 'vjen', english: 'he/she comes' },
                                    'ne': { form: 'vijmë', english: 'we come' },
                                    'ju': { form: 'vini', english: 'you (plural) come' },
                                    'ata/ato': { form: 'vijnë', english: 'they come' }
                                },
                                examples: [
                                    { albanian: 'Vij nesër në mëngjes', english: 'I come tomorrow morning' },
                                    { albanian: 'Ajo vjen shpesh këtu', english: 'She comes here often' },
                                    { albanian: 'Vijmë për darkë', english: 'We come for dinner' }
                                ]
                            },
                            {
                                infinitive: 'shkoj',
                                english: 'to go',
                                type: 'irregular',
                                conjugations: {
                                    'unë': { form: 'shkoj', english: 'I go' },
                                    'ti': { form: 'shkon', english: 'you go' },
                                    'ai/ajo': { form: 'shkon', english: 'he/she goes' },
                                    'ne': { form: 'shkojmë', english: 'we go' },
                                    'ju': { form: 'shkoni', english: 'you (plural) go' },
                                    'ata/ato': { form: 'shkojnë', english: 'they go' }
                                },
                                examples: [
                                    { albanian: 'Shkoj në punë të hënën', english: 'I go to work on Monday' },
                                    { albanian: 'Ne shkojmë së bashku', english: 'We go together' },
                                    { albanian: 'Ata shkojnë herët', english: 'They go early' }
                                ]
                            }
                        ],
                        commonPhrases: [
                            { pattern: 'greeting + time', example: 'Them mirëmëngjes në orën 8 (I say good morning at 8 o\"clock)', usage: 'Daily greeting routine' },
                            { pattern: 'movement + purpose', example: 'Vij për vizitë (I come for a visit)', usage: 'Explaining visit purpose' },
                            { pattern: 'departure + time', example: 'Shkoj nesër (I go tomorrow)', usage: 'Announcing departure plans' }
                        ]
                    },
                    'Card Game Terms': {
                        primaryVerbs: [
                            {
                                infinitive: 'filloj',
                                english: 'to start',
                                type: 'regular (-oj)',
                                conjugations: {
                                    'unë': { form: 'filloj', english: 'I start' },
                                    'ti': { form: 'fillon', english: 'you start' },
                                    'ai/ajo': { form: 'fillon', english: 'he/she starts' },
                                    'ne': { form: 'fillojmë', english: 'we start' },
                                    'ju': { form: 'filloni', english: 'you (plural) start' },
                                    'ata/ato': { form: 'fillojnë', english: 'they start' }
                                },
                                examples: [
                                    { albanian: 'Filloj lojën e re', english: 'I start the new game' },
                                    { albanian: 'Ti fillon mirë', english: 'You start well' },
                                    { albanian: 'Ne fillojmë mbrëmjen', english: 'We start the evening' }
                                ]
                            },
                            {
                                infinitive: 'ndal',
                                english: 'to stop',
                                type: 'irregular',
                                conjugations: {
                                    'unë': { form: 'ndal', english: 'I stop' },
                                    'ti': { form: 'ndalon', english: 'you stop' },
                                    'ai/ajo': { form: 'ndalon', english: 'he/she stops' },
                                    'ne': { form: 'ndalim', english: 'we stop' },
                                    'ju': { form: 'ndaloni', english: 'you (plural) stop' },
                                    'ata/ato': { form: 'ndalohin', english: 'they stop' }
                                },
                                examples: [
                                    { albanian: 'Ndal për pak', english: 'I stop for a bit' },
                                    { albanian: 'Ajo ndalon lojën', english: 'She stops the game' },
                                    { albanian: 'Ndalim për pushim', english: 'We stop for a break' }
                                ]
                            },
                            {
                                infinitive: 'dua',
                                english: 'to want',
                                type: 'irregular',
                                conjugations: {
                                    'unë': { form: 'dua', english: 'I want' },
                                    'ti': { form: 'do', english: 'you want' },
                                    'ai/ajo': { form: 'do', english: 'he/she wants' },
                                    'ne': { form: 'duam', english: 'we want' },
                                    'ju': { form: 'doni', english: 'you (plural) want' },
                                    'ata/ato': { form: 'duan', english: 'they want' }
                                },
                                examples: [
                                    { albanian: 'Dua të luaj letrat', english: 'I want to play cards' },
                                    { albanian: 'Do një lojë tjetër', english: 'You want another game' },
                                    { albanian: 'Duam të fillojmë', english: 'We want to start' }
                                ]
                            }
                        ],
                        commonPhrases: [
                            { pattern: 'want + infinitive', example: 'Dua të luaj (I want to play)', usage: 'Expressing desire to participate' },
                            { pattern: 'start + object', example: 'Filloj një lojë (I start a game)', usage: 'Initiating card games' },
                            { pattern: 'stop + reason', example: 'Ndal për pushim (I stop for a break)', usage: 'Taking game breaks' }
                        ]
                    },
                    'Winning & Losing': {
                        primaryVerbs: [
                            {
                                infinitive: 'fitoj',
                                english: 'to win',
                                type: 'regular (-oj)',
                                conjugations: {
                                    'unë': { form: 'fitoj', english: 'I win' },
                                    'ti': { form: 'fiton', english: 'you win' },
                                    'ai/ajo': { form: 'fiton', english: 'he/she wins' },
                                    'ne': { form: 'fitojmë', english: 'we win' },
                                    'ju': { form: 'fitoni', english: 'you (plural) win' },
                                    'ata/ato': { form: 'fitojnë', english: 'they win' }
                                },
                                examples: [
                                    { albanian: 'Fitoj rrallëherë', english: 'I win rarely' },
                                    { albanian: 'Ti fiton shpesh', english: 'You win often' },
                                    { albanian: 'Ata fitojnë së bashku', english: 'They win together' }
                                ]
                            },
                            {
                                infinitive: 'humbas',
                                english: 'to lose',
                                type: 'irregular',
                                conjugations: {
                                    'unë': { form: 'humbas', english: 'I lose' },
                                    'ti': { form: 'humbet', english: 'you lose' },
                                    'ai/ajo': { form: 'humbet', english: 'he/she loses' },
                                    'ne': { form: 'humbim', english: 'we lose' },
                                    'ju': { form: 'humbni', english: 'you (plural) lose' },
                                    'ata/ato': { form: 'humbin', english: 'they lose' }
                                },
                                examples: [
                                    { albanian: 'Humbas me dinjitet', english: 'I lose with dignity' },
                                    { albanian: 'Ajo humbet rrallë', english: 'She loses rarely' },
                                    { albanian: 'Humbim si familje', english: 'We lose as a family' }
                                ]
                            },
                            {
                                infinitive: 'provoj',
                                english: 'to try',
                                type: 'regular (-oj)',
                                conjugations: {
                                    'unë': { form: 'provoj', english: 'I try' },
                                    'ti': { form: 'provon', english: 'you try' },
                                    'ai/ajo': { form: 'provon', english: 'he/she tries' },
                                    'ne': { form: 'provojmë', english: 'we try' },
                                    'ju': { form: 'provoni', english: 'you (plural) try' },
                                    'ata/ato': { form: 'provojnë', english: 'they try' }
                                },
                                examples: [
                                    { albanian: 'Provoj përsëri', english: 'I try again' },
                                    { albanian: 'Ti provon fort', english: 'You try hard' },
                                    { albanian: 'Provojmë së bashku', english: 'We try together' }
                                ]
                            }
                        ],
                        commonPhrases: [
                            { pattern: 'win + frequency', example: 'Fitoj ndonjëherë (I win sometimes)', usage: 'Modest success acknowledgment' },
                            { pattern: 'lose + attitude', example: 'Humbas me buzëqeshje (I lose with a smile)', usage: 'Graceful losing in family games' },
                            { pattern: 'try + again', example: 'Provoj përsëri (I try again)', usage: 'Encouraging persistence' }
                        ]
                    },
                    'Expressing Opinions': {
                        primaryVerbs: [
                            {
                                infinitive: 'mendoj',
                                english: 'to think',
                                type: 'regular (-oj)',
                                conjugations: {
                                    'unë': { form: 'mendoj', english: 'I think' },
                                    'ti': { form: 'mendon', english: 'you think' },
                                    'ai/ajo': { form: 'mendon', english: 'he/she thinks' },
                                    'ne': { form: 'mendojmë', english: 'we think' },
                                    'ju': { form: 'mendoni', english: 'you (plural) think' },
                                    'ata/ato': { form: 'mendojnë', english: 'they think' }
                                },
                                examples: [
                                    { albanian: 'Mendoj se është mirë', english: 'I think it\"s good' },
                                    { albanian: 'Ti mendon ndryshe', english: 'You think differently' },
                                    { albanian: 'Ne mendojmë njësoj', english: 'We think the same' }
                                ]
                            },
                            {
                                infinitive: 'besoj',
                                english: 'to believe',
                                type: 'regular (-oj)',
                                conjugations: {
                                    'unë': { form: 'besoj', english: 'I believe' },
                                    'ti': { form: 'beson', english: 'you believe' },
                                    'ai/ajo': { form: 'beson', english: 'he/she believes' },
                                    'ne': { form: 'besojmë', english: 'we believe' },
                                    'ju': { form: 'besoni', english: 'you (plural) believe' },
                                    'ata/ato': { form: 'besojnë', english: 'they believe' }
                                },
                                examples: [
                                    { albanian: 'Besoj në ty', english: 'I believe in you' },
                                    { albanian: 'Ajo beson fort', english: 'She believes strongly' },
                                    { albanian: 'Besojmë në familje', english: 'We believe in family' }
                                ]
                            },
                            {
                                infinitive: 'pëlqej',
                                english: 'to like',
                                type: 'irregular',
                                conjugations: {
                                    'unë': { form: 'pëlqej', english: 'I like' },
                                    'ti': { form: 'pëlqen', english: 'you like' },
                                    'ai/ajo': { form: 'pëlqen', english: 'he/she likes' },
                                    'ne': { form: 'pëlqejmë', english: 'we like' },
                                    'ju': { form: 'pëlqeni', english: 'you (plural) like' },
                                    'ata/ato': { form: 'pëlqejnë', english: 'they like' }
                                },
                                examples: [
                                    { albanian: 'Më pëlqen ky film', english: 'I like this movie' },
                                    { albanian: 'Ti pëlqen muzikën', english: 'You like music' },
                                    { albanian: 'Na pëlqen kjo ide', english: 'We like this idea' }
                                ]
                            }
                        ],
                        commonPhrases: [
                            { pattern: 'think + that clause', example: 'Mendoj se është e drejtë (I think it\"s right)', usage: 'Expressing thoughtful opinions' },
                            { pattern: 'believe + in', example: 'Besoj në drejtësi (I believe in justice)', usage: 'Stating core values' },
                            { pattern: 'like + object', example: 'Më pëlqen ideja (I like the idea)', usage: 'Showing preference' }
                        ]
                    }
                };
                
                return verbData[topicName] || { primaryVerbs: [], commonPhrases: [] };
            };
            
            // Generate practice exercises for the topic
            const generatePracticeExercises = (topicName) => {
                const exercises = {
                    'Game Conversation': [
                        { type: 'translation', english: 'I play cards', albanian: 'Unë luaj letërkë', options: ['Unë luaj letërkë', 'Ti luan letërkë', 'Ne luajmë letërkë'], correct: 0 },
                        { type: 'conjugation', verb: 'luaj', person: 'ti', correct: 'luan', english: 'you play' },
                        { type: 'phrase-complete', partial: 'Luajmë ___', options: ['një lojë', 'me miq', 'së bashku'], correct: 2, english: 'We play together' },
                        { type: 'translation', english: 'Good game!', albanian: 'Lojë e mirë!', options: ['Lojë e mirë!', 'Fitova!', 'Radhë ime!'], correct: 0 }
                    ],
                    'Food Names': [
                        { type: 'translation', english: 'I eat bread', albanian: 'Unë ha bukë', options: ['Unë ha bukë', 'Ti ha bukë', 'Ne hamë bukë'], correct: 0 },
                        { type: 'conjugation', verb: 'gatuaj', person: 'ajo', correct: 'gatuan', english: 'she cooks' },
                        { type: 'phrase-complete', partial: 'Hamë ___', options: ['bukë', 'së bashku', 'gjithmonë'], correct: 1, english: 'We eat together' },
                        { type: 'translation', english: "Let's eat!", albanian: 'Hajde të hamë!', options: ['Hajde të hamë!', 'Unë ha!', 'Ti ha!'], correct: 0 }
                    ],
                    'Home & Rooms': [
                        { type: 'translation', english: 'I live here', albanian: 'Unë jetoj këtu', options: ['Unë jetoj këtu', 'Ti jeton këtu', 'Ne jetojmë këtu'], correct: 0 },
                        { type: 'conjugation', verb: 'ndërtoj', person: 'ne', correct: 'ndërtojmë', english: 'we build' },
                        { type: 'phrase-complete', partial: 'Jetojmë në ___', options: ['shtëpi', 'familje', 'paqe'], correct: 0, english: 'We live in a house' },
                        { type: 'translation', english: 'Welcome home!', albanian: 'Mirë se erdhët në shtëpi!', options: ['Mirë se erdhët!', 'Faleminderit!', 'Mirupafshim!'], correct: 0 }
                    ],
                    'Daily Activities': [
                        { type: 'translation', english: 'I wake up early', albanian: 'Unë zgjohem herët', options: ['Unë zgjohem herët', 'Ti zgjohesh herët', 'Ne zgjohemi herët'], correct: 0 },
                        { type: 'conjugation', verb: 'punoj', person: 'ju', correct: 'punoni', english: 'you work' },
                        { type: 'phrase-complete', partial: 'Punojmë ___', options: ['shumë', 'bashkë', 'mirë'], correct: 1, english: 'We work together' },
                        { type: 'translation', english: 'Good morning!', albanian: 'Mirëmëngjes!', options: ['Mirëmëngjes!', 'Mirëdita!', 'Mirupafshim!'], correct: 0 }
                    ],
                    'Expressing Opinions': [
                        { type: 'translation', english: 'I think so', albanian: 'Mendoj ashtu', options: ['Mendoj ashtu', 'Besoj ashtu', 'Them ashtu'], correct: 0 },
                        { type: 'conjugation', verb: 'besoj', person: 'ata', correct: 'besojnë', english: 'they believe' },
                        { type: 'phrase-complete', partial: 'Më pëlqen ___', options: ['kjo ide', 'të mendoj', 'shumë'], correct: 0, english: 'I like this idea' },
                        { type: 'translation', english: 'In my opinion...', albanian: 'Sipas mendimit tim...', options: ['Sipas mendimit tim...', 'Mendoj se...', 'Besoj se...'], correct: 0 }
                    ],
                    'Hello and Goodbye': [
                        { type: 'translation', english: 'Good morning!', albanian: 'Mirëmëngjes!', options: ['Mirëmëngjes!', 'Mirëdita!', 'Mirëmbrëma!'], correct: 0 },
                        { type: 'conjugation', verb: 'them', person: 'unë', correct: 'them', english: 'I say' },
                        { type: 'phrase-complete', partial: 'Mirë ___', options: ['se erdhe', 'ditë', 'mëngjes'], correct: 0, english: 'Welcome' },
                        { type: 'translation', english: 'See you later!', albanian: 'Shihemi më vonë!', options: ['Shihemi më vonë!', 'Mirupafshim!', 'Faleminderit!'], correct: 0 },
                        { type: 'translation', english: 'How are you?', albanian: 'Si jeni?', options: ['Si jeni?', 'Ku jeni?', 'Çfarë bëni?'], correct: 0 },
                        { type: 'phrase-complete', partial: 'Faleminderit ___', options: ['shumë', 'mirë', 'bukur'], correct: 0, english: 'Thank you very much' }
                    ]
                };
                return exercises[topicName] || [];
            };

            const [exercises, setExercises] = useState([]);
            const [currentExerciseIndex, setCurrentExerciseIndex] = useState(0);
            const [score, setScore] = useState(0);
            const [selectedAnswer, setSelectedAnswer] = useState(null);
            const [showResult, setShowResult] = useState(false);
            const [userInput, setUserInput] = useState('');

            useEffect(() => {
                const loadDynamicExercises = async () => {
                    try {
                        setLoading(true);
                        
                        // First, get all topics to find the correct slug for this topic name
                        const topicsResponse = await fetch('/api/exercises/topics');
                        const topicsData = await topicsResponse.json();
                        
                        let topicSlug = null;
                        if (topicsData.success) {
                            const matchingTopic = topicsData.topics.find(t => t.name === topic.name);
                            topicSlug = matchingTopic?.slug;
                        }
                        
                        if (!topicSlug) {
                            console.log(`No topic found with name: ${topic.name}`);
                            // Fallback to hardcoded exercises
                            const practiceExercises = generatePracticeExercises(topic.name);
                            setExercises(practiceExercises);
                            setLoading(false);
                            return;
                        }
                        
                        const response = await fetch(`/api/exercises/${topicSlug}?limit=10`);
                        const data = await response.json();
                        
                        if (data.success && data.exercises.length > 0) {
                            // Transform dynamic exercises to match expected format
                            const transformedExercises = data.exercises.map(exercise => ({
                                type: exercise.exercise_type,
                                english: exercise.question_text,
                                albanian: exercise.correct_answer,
                                options: exercise.options,
                                correct: exercise.exercise_type === 'multiple-choice' || exercise.exercise_type === 'translation' 
                                    ? exercise.options.findIndex(opt => opt === exercise.correct_answer)
                                    : exercise.correct_answer,
                                verb: exercise.exercise_type === 'conjugation' ? exercise.question_text.split(' ')[0] : null,
                                person: exercise.exercise_type === 'conjugation' ? exercise.question_text.split(' → ')[1]?.split(' ')[0] : null,
                                partial: exercise.exercise_type === 'phrase-complete' ? exercise.question_text.replace('___', '___') : null,
                                explanation: exercise.explanation,
                                cultural_notes: exercise.cultural_notes
                            }));
                            
                            setExercises(transformedExercises);
                        } else {
                            // Fallback to hardcoded exercises if no dynamic exercises found
                            console.log('No dynamic exercises found, using hardcoded fallback');
                            const practiceExercises = generatePracticeExercises(topic.name);
                            setExercises(practiceExercises);
                        }
                    } catch (error) {
                        console.error('Error loading dynamic exercises:', error);
                        // Fallback to hardcoded exercises on error
                        const practiceExercises = generatePracticeExercises(topic.name);
                        setExercises(practiceExercises);
                    } finally {
                        setLoading(false);
                    }
                };
                
                loadDynamicExercises();
                setCurrentExerciseIndex(0);
                setScore(0);
                setSelectedAnswer(null);
                setShowResult(false);
                setUserInput('');
            }, [topic.name]);

            const handleAnswer = (answerIndex, isInput = false) => {
                const exercise = exercises[currentExerciseIndex];
                let correct = false;
                
                if (isInput) {
                    correct = userInput.toLowerCase().trim() === exercise.correct.toLowerCase();
                } else if (exercise.type === 'conjugation') {
                    correct = userInput.toLowerCase().trim() === exercise.correct.toLowerCase();
                } else {
                    correct = answerIndex === exercise.correct;
                }
                
                if (correct) {
                    setScore(score + 1);
                }
                
                setSelectedAnswer(answerIndex);
                setShowResult(true);
                
                setTimeout(() => {
                    if (currentExerciseIndex < exercises.length - 1) {
                        setCurrentExerciseIndex(currentExerciseIndex + 1);
                        setSelectedAnswer(null);
                        setShowResult(false);
                        setUserInput('');
                    } else {
                        // Practice completed
                        saveProgress(topic.id, { score: score + (correct ? 1 : 0), total: exercises.length });
                        onNext();
                    }
                }, 2000);
            };

            if (loading) {
                return (
                    <div style={{textAlign: 'center', padding: '40px'}}>
                        <div style={{fontSize: '1.2em', color: '#64748b', marginBottom: '10px'}}>
                            Loading dynamic practice exercises...
                        </div>
                        <div style={{fontSize: '0.9em', color: '#999'}}>
                            Fetching AI-generated exercises for {topic.name}
                        </div>
                    </div>
                );
            }

            if (!exercises.length) {
                return (
                    <div style={{textAlign: 'center', padding: '40px'}}>
                        <div style={{fontSize: '1.2em', color: '#dc2626', marginBottom: '10px'}}>
                            No practice exercises available for {topic.name}
                        </div>
                        <div style={{fontSize: '0.9em', color: '#999'}}>
                            Try generating exercises using the admin panel
                        </div>
                    </div>
                );
            }

            const exercise = exercises[currentExerciseIndex];
            
            return (
                <div className="practice-section" style={{maxWidth: '800px', margin: '0 auto', padding: '20px'}}>
                    <div style={{textAlign: 'center', marginBottom: '40px'}}>
                        <h3 style={{fontSize: '2em', marginBottom: '15px', color: '#0f172a'}}>
                            Practice: {topic.name}
                        </h3>
                        <p style={{fontSize: '1.2em', color: '#64748b'}}>
                            Exercise {currentExerciseIndex + 1} of {exercises.length} | Score: {score}/{currentExerciseIndex + (showResult ? 1 : 0)}
                        </p>
                    </div>
                    
                    <div style={{
                        background: '#ffffff',
                        border: '2px solid #e2e8f0',
                        borderRadius: '20px',
                        padding: '40px',
                        marginBottom: '30px',
                        boxShadow: '0 4px 15px rgba(0,0,0,0.05)',
                        textAlign: 'center'
                    }}>
                        {exercise.type === 'translation' && (
                            <>
                                <h4 style={{fontSize: '1.5em', color: '#2563eb', marginBottom: '20px'}}>
                                    Translate to Albanian:
                                </h4>
                                <p style={{fontSize: '1.3em', color: '#0f172a', marginBottom: '30px', fontWeight: '600'}}>
                                    "{exercise.english}"
                                </p>
                                <div style={{display: 'grid', gap: '15px', maxWidth: '500px', margin: '0 auto'}}>
                                    {exercise.options.map((option, index) => (
                                        <button
                                            key={index}
                                            onClick={() => handleAnswer(index)}
                                            disabled={showResult}
                                            style={{
                                                padding: '15px 25px',
                                                fontSize: '1.1em',
                                                backgroundColor: showResult ? 
                                                    (index === exercise.correct ? '#dcfce7' : 
                                                     index === selectedAnswer ? '#fecaca' : '#f8faff') : '#f8faff',
                                                color: showResult ?
                                                    (index === exercise.correct ? '#166534' :
                                                     index === selectedAnswer ? '#dc2626' : '#0f172a') : '#0f172a',
                                                border: showResult ?
                                                    (index === exercise.correct ? '2px solid #10b981' :
                                                     index === selectedAnswer ? '2px solid #ef4444' : '2px solid #e2e8f0') : '2px solid #e2e8f0',
                                                borderRadius: '12px',
                                                cursor: showResult ? 'default' : 'pointer',
                                                transition: 'all 0.2s ease'
                                            }}
                                        >
                                            {option}
                                        </button>
                                    ))}
                                </div>
                            </>
                        )}
                        
                        {exercise.type === 'conjugation' && (
                            <>
                                <h4 style={{fontSize: '1.5em', color: '#2563eb', marginBottom: '20px'}}>
                                    Conjugate the verb:
                                </h4>
                                <p style={{fontSize: '1.3em', color: '#0f172a', marginBottom: '15px'}}>
                                    <strong>{exercise.verb}</strong> → <strong>{exercise.person}</strong>
                                </p>
                                <p style={{fontSize: '1.1em', color: '#64748b', marginBottom: '25px'}}>
                                    ({exercise.english})
                                </p>
                                <div style={{maxWidth: '400px', margin: '0 auto'}}>
                                    <input
                                        type="text"
                                        value={userInput}
                                        onChange={(e) => setUserInput(e.target.value)}
                                        onKeyPress={(e) => e.key === 'Enter' && !showResult && handleAnswer(null, true)}
                                        placeholder="Type your answer here..."
                                        disabled={showResult}
                                        style={{
                                            width: '100%',
                                            padding: '15px 20px',
                                            fontSize: '1.2em',
                                            border: showResult ?
                                                (userInput.toLowerCase().trim() === exercise.correct.toLowerCase() ? '2px solid #10b981' : '2px solid #ef4444') :
                                                '2px solid #e2e8f0',
                                            borderRadius: '12px',
                                            textAlign: 'center',
                                            backgroundColor: showResult ?
                                                (userInput.toLowerCase().trim() === exercise.correct.toLowerCase() ? '#dcfce7' : '#fecaca') : '#ffffff'
                                        }}
                                    />
                                    {!showResult && (
                                        <button
                                            onClick={() => handleAnswer(null, true)}
                                            style={{
                                                marginTop: '15px',
                                                padding: '10px 30px',
                                                backgroundColor: '#2563eb',
                                                color: 'white',
                                                border: 'none',
                                                borderRadius: '20px',
                                                fontSize: '1.1em',
                                                cursor: 'pointer'
                                            }}
                                        >
                                            Check Answer
                                        </button>
                                    )}
                                    {showResult && (
                                        <div style={{marginTop: '15px', fontSize: '1.1em'}}>
                                            <p style={{color: userInput.toLowerCase().trim() === exercise.correct.toLowerCase() ? '#166534' : '#dc2626', fontWeight: '600'}}>
                                                {userInput.toLowerCase().trim() === exercise.correct.toLowerCase() ? '✅ Correct!' : '❌ Incorrect'}
                                            </p>
                                            {userInput.toLowerCase().trim() !== exercise.correct.toLowerCase() && (
                                                <p style={{color: '#166534', marginTop: '10px'}}>
                                                    Correct answer: <strong>{exercise.correct}</strong>
                                                </p>
                                            )}
                                        </div>
                                    )}
                                </div>
                            </>
                        )}
                        
                        {exercise.type === 'phrase-complete' && (
                            <>
                                <h4 style={{fontSize: '1.5em', color: '#2563eb', marginBottom: '20px'}}>
                                    Complete the phrase:
                                </h4>
                                <p style={{fontSize: '1.4em', color: '#0f172a', marginBottom: '15px', fontWeight: '600'}}>
                                    {exercise.partial}
                                </p>
                                <p style={{fontSize: '1.1em', color: '#64748b', marginBottom: '25px', fontStyle: 'italic'}}>
                                    ({exercise.english})
                                </p>
                                <div style={{display: 'grid', gap: '15px', maxWidth: '400px', margin: '0 auto'}}>
                                    {exercise.options.map((option, index) => (
                                        <button
                                            key={index}
                                            onClick={() => handleAnswer(index)}
                                            disabled={showResult}
                                            style={{
                                                padding: '15px 25px',
                                                fontSize: '1.1em',
                                                backgroundColor: showResult ? 
                                                    (index === exercise.correct ? '#dcfce7' : 
                                                     index === selectedAnswer ? '#fecaca' : '#f8faff') : '#f8faff',
                                                color: showResult ?
                                                    (index === exercise.correct ? '#166534' :
                                                     index === selectedAnswer ? '#dc2626' : '#0f172a') : '#0f172a',
                                                border: showResult ?
                                                    (index === exercise.correct ? '2px solid #10b981' :
                                                     index === selectedAnswer ? '2px solid #ef4444' : '2px solid #e2e8f0') : '2px solid #e2e8f0',
                                                borderRadius: '12px',
                                                cursor: showResult ? 'default' : 'pointer',
                                                transition: 'all 0.2s ease'
                                            }}
                                        >
                                            {option}
                                        </button>
                                    ))}
                                </div>
                            </>
                        )}
                        
                        {showResult && (
                            <div style={{
                                marginTop: '25px',
                                padding: '15px',
                                backgroundColor: selectedAnswer === exercise.correct || (exercise.type === 'conjugation' && userInput.toLowerCase().trim() === exercise.correct.toLowerCase()) ? '#dcfce7' : '#fef2f2',
                                borderRadius: '12px',
                                border: selectedAnswer === exercise.correct || (exercise.type === 'conjugation' && userInput.toLowerCase().trim() === exercise.correct.toLowerCase()) ? '2px solid #10b981' : '2px solid #ef4444'
                            }}>
                                <p style={{fontSize: '1.1em', fontWeight: '600', marginBottom: '10px'}}>
                                    {selectedAnswer === exercise.correct || (exercise.type === 'conjugation' && userInput.toLowerCase().trim() === exercise.correct.toLowerCase()) ? '🎉 Great job!' : '💪 Keep practicing!'}
                                </p>
                                {exercise.type === 'translation' && (
                                    <p style={{color: '#64748b'}}>
                                        <strong>Correct:</strong> {exercise.albanian}
                                    </p>
                                )}
                                
                                {/* Show explanation if available */}
                                {exercise.explanation && (
                                    <div style={{
                                        marginTop: '15px',
                                        padding: '12px',
                                        backgroundColor: 'rgba(255, 255, 255, 0.7)',
                                        borderRadius: '8px',
                                        borderLeft: '4px solid #2563eb'
                                    }}>
                                        <p style={{fontSize: '0.9em', color: '#0f172a', fontWeight: '600', marginBottom: '5px'}}>
                                            💡 Explanation:
                                        </p>
                                        <p style={{fontSize: '0.9em', color: '#555', lineHeight: '1.4'}}>
                                            {exercise.explanation}
                                        </p>
                                    </div>
                                )}
                                
                                {/* Show cultural notes if available */}
                                {exercise.cultural_notes && (
                                    <div style={{
                                        marginTop: '15px',
                                        padding: '12px',
                                        backgroundColor: 'rgba(255, 255, 255, 0.7)',
                                        borderRadius: '8px',
                                        borderLeft: '4px solid #10b981'
                                    }}>
                                        <p style={{fontSize: '0.9em', color: '#0f172a', fontWeight: '600', marginBottom: '5px'}}>
                                            🇦🇱 Cultural Context:
                                        </p>
                                        <p style={{fontSize: '0.9em', color: '#555', lineHeight: '1.4'}}>
                                            {exercise.cultural_notes}
                                        </p>
                                    </div>
                                )}
                            </div>
                        )}
                    </div>
                    
                    <div style={{display: 'flex', justifyContent: 'center', gap: '20px', marginTop: '30px'}}>
                        <button 
                            onClick={onPrev}
                            style={{
                                padding: '15px 30px',
                                backgroundColor: '#f8faff',
                                color: '#2563eb',
                                border: '2px solid #2563eb',
                                borderRadius: '20px',
                                fontSize: '1.1em',
                                cursor: 'pointer'
                            }}
                        >
                            ← Back to Verbs
                        </button>
                    </div>
                    
                    <div>End of Practice Section Test</div>
                </div>
            );
        };


        // ConjugationExercise Component
        const ConjugationExercise = ({ data, onComplete }) => {
            const [selectedAnswer, setSelectedAnswer] = useState(null);
            const [showResult, setShowResult] = useState(false);
            
            const handleSubmit = () => {
                const isCorrect = selectedAnswer === data.correct;
                setShowResult(true);
                
                setTimeout(() => {
                    onComplete(isCorrect);
                    setSelectedAnswer(null);
                    setShowResult(false);
                }, 2000);
            };
            
            return (
                <div className="exercise-container">
                    <div className="exercise-type">Verb Conjugation</div>
                    
                    <div style={{textAlign: 'center', padding: '40px 20px'}}>
                        <div style={{fontSize: '1.3em', color: '#64748b', marginBottom: '20px'}}>
                            Choose the correct conjugation:
                        </div>
                        
                        <div style={{fontSize: '2.2em', color: '#0f172a', marginBottom: '30px', lineHeight: '1.4'}}>
                            {data.prompt.replace('___', '_____')}
                        </div>
                        
                        <div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '15px', maxWidth: '600px', margin: '0 auto'}}>
                            {data.options.map((option, index) => (
                                <button
                                    key={index}
                                    className={`option-button ${selectedAnswer === option ? 'selected' : ''}`}
                                    onClick={() => setSelectedAnswer(option)}
                                    disabled={showResult}
                                    style={{
                                        padding: '15px 20px',
                                        fontSize: '1.3em',
                                        borderRadius: '10px',
                                        border: '2px solid #e2e8f0',
                                        background: selectedAnswer === option ? '#2563eb' : 'white',
                                        color: selectedAnswer === option ? 'white' : '#0f172a',
                                        cursor: 'pointer',
                                        transition: 'all 0.3s ease'
                                    }}
                                >
                                    {option}
                                </button>
                            ))}
                        </div>
                        
                        {showResult && (
                            <div style={{
                                background: selectedAnswer === data.correct ? '#f0fdf4' : '#fef2f2',
                                border: `2px solid ${selectedAnswer === data.correct ? '#10b981' : '#ef4444'}`,
                                borderRadius: '12px',
                                padding: '20px',
                                margin: '30px auto',
                                maxWidth: '500px'
                            }}>
                                <div style={{
                                    fontSize: '1.2em',
                                    fontWeight: '600',
                                    color: selectedAnswer === data.correct ? '#166534' : '#dc2626',
                                    marginBottom: '10px'
                                }}>
                                    {selectedAnswer === data.correct ? '✅ Correct!' : '❌ Incorrect'}
                                </div>
                                <div style={{color: '#64748b', fontSize: '1.1em'}}>
                                    Correct answer: <strong>{data.correct}</strong>
                                </div>
                            </div>
                        )}
                        
                        <button 
                            className="btn btn-primary" 
                            onClick={handleSubmit}
                            disabled={!selectedAnswer || showResult}
                            style={{marginTop: '30px'}}
                        >
                            Check Answer
                        </button>
                    </div>
                </div>
            );
        };
        
        // FillBlankExercise Component
        const FillBlankExercise = ({ data, onComplete }) => {
            const [selectedAnswer, setSelectedAnswer] = useState(null);
            const [showResult, setShowResult] = useState(false);
            
            const handleSubmit = () => {
                const isCorrect = selectedAnswer === data.correct;
                setShowResult(true);
                
                setTimeout(() => {
                    onComplete(isCorrect);
                    setSelectedAnswer(null);
                    setShowResult(false);
                }, 2000);
            };
            
            return (
                <div className="exercise-container">
                    <div className="exercise-type">Fill in the Blank</div>
                    
                    <div style={{textAlign: 'center', padding: '40px 20px'}}>
                        <div style={{fontSize: '1.3em', color: '#64748b', marginBottom: '10px'}}>
                            Complete the sentence:
                        </div>
                        
                        <div style={{fontSize: '1.1em', color: '#888', marginBottom: '30px', fontStyle: 'italic'}}>
                            {data.english}
                        </div>
                        
                        <div style={{fontSize: '2.5em', color: '#0f172a', marginBottom: '40px', lineHeight: '1.4'}}>
                            {data.sentence.split('____').map((part, index) => (
                                <span key={index}>
                                    {part}
                                    {index < data.sentence.split('____').length - 1 && (
                                        <span style={{
                                            background: selectedAnswer ? '#2563eb' : '#f0f4ff',
                                            color: selectedAnswer ? 'white' : '#2563eb',
                                            padding: '5px 15px',
                                            borderRadius: '8px',
                                            border: '2px dashed #2563eb',
                                            fontWeight: 'bold'
                                        }}>
                                            {selectedAnswer || '____'}
                                        </span>
                                    )}
                                </span>
                            ))}
                        </div>
                        
                        <div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(150px, 1fr))', gap: '15px', maxWidth: '500px', margin: '0 auto'}}>
                            {data.options.map((option, index) => (
                                <button
                                    key={index}
                                    className={`option-button ${selectedAnswer === option ? 'selected' : ''}`}
                                    onClick={() => setSelectedAnswer(option)}
                                    disabled={showResult}
                                    style={{
                                        padding: '12px 16px',
                                        fontSize: '1.2em',
                                        borderRadius: '10px',
                                        border: '2px solid #e2e8f0',
                                        background: selectedAnswer === option ? '#2563eb' : 'white',
                                        color: selectedAnswer === option ? 'white' : '#0f172a',
                                        cursor: 'pointer',
                                        transition: 'all 0.3s ease'
                                    }}
                                >
                                    {option}
                                </button>
                            ))}
                        </div>
                        
                        {showResult && (
                            <div style={{
                                background: selectedAnswer === data.correct ? '#f0fdf4' : '#fef2f2',
                                border: `2px solid ${selectedAnswer === data.correct ? '#10b981' : '#ef4444'}`,
                                borderRadius: '12px',
                                padding: '20px',
                                margin: '30px auto',
                                maxWidth: '500px'
                            }}>
                                <div style={{
                                    fontSize: '1.2em',
                                    fontWeight: '600',
                                    color: selectedAnswer === data.correct ? '#166534' : '#dc2626',
                                    marginBottom: '10px'
                                }}>
                                    {selectedAnswer === data.correct ? '✅ Perfect!' : '❌ Try again next time'}
                                </div>
                                <div style={{color: '#64748b', marginBottom: '10px'}}>
                                    <strong>Explanation:</strong> {data.explanation}
                                </div>
                            </div>
                        )}
                        
                        <button 
                            className="btn btn-primary" 
                            onClick={handleSubmit}
                            disabled={!selectedAnswer || showResult}
                            style={{marginTop: '30px'}}
                        >
                            Submit Answer
                        </button>
                    </div>
                </div>
            );
        };
        
        // TranslationExercise Component
        const TranslationExercise = ({ data, onComplete }) => {
            const [userTranslation, setUserTranslation] = useState('');
            const [showResult, setShowResult] = useState(false);
            
            const handleSubmit = () => {
                const isCorrect = userTranslation.toLowerCase().trim() === data.correct.toLowerCase().trim();
                setShowResult(true);
                
                setTimeout(() => {
                    onComplete(isCorrect);
                    setUserTranslation('');
                    setShowResult(false);
                }, 3000);
            };
            
            return (
                <div className="exercise-container">
                    <div className="exercise-type">Translation</div>
                    
                    <div style={{textAlign: 'center', padding: '40px 20px'}}>
                        <div style={{fontSize: '1.3em', color: '#64748b', marginBottom: '30px'}}>
                            Translate this to Albanian:
                        </div>
                        
                        <div style={{fontSize: '2.2em', color: '#0f172a', marginBottom: '40px', fontWeight: '500'}}>
                            "{data.english}"
                        </div>
                        
                        <div style={{maxWidth: '500px', margin: '0 auto'}}>
                            <input
                                type="text"
                                value={userTranslation}
                                onChange={(e) => setUserTranslation(e.target.value)}
                                placeholder="Type your Albanian translation..."
                                disabled={showResult}
                                style={{
                                    width: '100%',
                                    padding: '15px 20px',
                                    fontSize: '1.3em',
                                    border: '2px solid #e2e8f0',
                                    borderRadius: '10px',
                                    textAlign: 'center',
                                    marginBottom: '30px',
                                    outline: 'none',
                                    transition: 'border-color 0.3s ease'
                                }}
                                onFocus={(e) => e.target.style.borderColor = '#2563eb'}
                                onBlur={(e) => e.target.style.borderColor = '#e2e8f0'}
                            />
                        </div>
                        
                        {showResult && (
                            <div style={{
                                background: userTranslation.toLowerCase().trim() === data.correct.toLowerCase().trim() ? '#f0fdf4' : '#fef9e7',
                                border: `2px solid ${userTranslation.toLowerCase().trim() === data.correct.toLowerCase().trim() ? '#10b981' : '#f59e0b'}`,
                                borderRadius: '12px',
                                padding: '25px',
                                margin: '30px auto',
                                maxWidth: '500px',
                                textAlign: 'left'
                            }}>
                                <div style={{
                                    fontSize: '1.2em',
                                    fontWeight: '600',
                                    color: userTranslation.toLowerCase().trim() === data.correct.toLowerCase().trim() ? '#166534' : '#92400e',
                                    marginBottom: '15px'
                                }}>
                                    {userTranslation.toLowerCase().trim() === data.correct.toLowerCase().trim() ? '✅ Excellent!' : '📝 Good effort!'}
                                </div>
                                <div style={{marginBottom: '10px'}}>
                                    <strong style={{color: '#0f172a'}}>Your answer:</strong> <span style={{fontStyle: 'italic'}}>{userTranslation}</span>
                                </div>
                                <div style={{marginBottom: '15px'}}>
                                    <strong style={{color: '#0f172a'}}>Correct answer:</strong> <span style={{fontWeight: 'bold', color: '#2563eb'}}>{data.correct}</span>
                                </div>
                                <div style={{color: '#64748b'}}>
                                    <strong>Context:</strong> {data.explanation}
                                </div>
                            </div>
                        )}
                        
                        <button 
                            className="btn btn-primary" 
                            onClick={handleSubmit}
                            disabled={!userTranslation.trim() || showResult}
                            style={{marginTop: '20px'}}
                        >
                            Check Translation
                        </button>
                    </div>
                </div>
            );
        };
        
        // FlashcardExercise Component (Enhanced)
        const FlashcardExercise = ({ data, onComplete }) => {
            const [showAnswer, setShowAnswer] = useState(false);
            const [difficulty, setDifficulty] = useState(3);
            
            const handleReveal = () => {
                setShowAnswer(true);
            };
            
            const handleAnswer = (level) => {
                const isCorrect = level === 'good' || level === 'easy';
                setShowAnswer(false);
                onComplete(isCorrect);
            };
            
            return (
                <div className="exercise-container">
                    <div className="exercise-type">Flashcard</div>
                    
                    <div className="difficulty-stars">
                        {[1,2,3,4,5].map(n => (
                            <span key={n} className={`star ${n <= difficulty ? '' : 'empty'}`}>
                                ★
                            </span>
                        ))}
                    </div>
                    
                    {!showAnswer ? (
                        <div className="flashcard-front">
                            <div className="english-prompt">
                                {data.english}
                            </div>
                            <button className="btn btn-primary" onClick={handleReveal}>
                                Tap to Reveal
                            </button>
                        </div>
                    ) : (
                        <div className="flashcard-back">
                            <div className="albanian-answer">
                                {data.albanian}
                            </div>
                            <div className="pronunciation">
                                /Albanian pronunciation/
                            </div>
                            {data.context && (
                                <div className="cultural-note">
                                    {data.context}
                                </div>
                            )}
                            <div style={{marginTop: '30px'}}>
                                <button className="btn btn-danger" onClick={() => handleAnswer('again')}>
                                    Again
                                </button>
                                <button className="btn btn-warning" onClick={() => handleAnswer('hard')}>
                                    Hard
                                </button>
                                <button className="btn btn-success" onClick={() => handleAnswer('good')}>
                                    Good
                                </button>
                                <button className="btn btn-primary" onClick={() => handleAnswer('easy')}>
                                    Easy
                                </button>
                            </div>
                        </div>
                    )}
                </div>
            );
        };
        
        // ConversationExercise Component
        const ConversationExercise = ({ data, topic, onComplete }) => {
            const [selectedOption, setSelectedOption] = useState(null);
            const [showResult, setShowResult] = useState(false);
            
            const handleOptionSelect = (optionIndex) => {
                setSelectedOption(optionIndex);
            };
            
            const handleSubmit = () => {
                const selectedOptionData = data.options[selectedOption];
                const isCorrect = selectedOptionData.correct;
                setShowResult(true);
                
                setTimeout(() => {
                    onComplete(isCorrect);
                    setSelectedOption(null);
                    setShowResult(false);
                }, 3000);
            };
            
            return (
                <div className="exercise-container">
                    <div className="exercise-type">Conversation</div>
                    
                    <div className="conversation-scenario">
                        <p style={{fontSize: '1.1em', marginBottom: '20px', lineHeight: '1.6'}}>
                            {data.scenario}
                        </p>
                        
                        <p style={{marginTop: '20px', fontWeight: '600', color: '#0f172a', fontSize: '1.2em'}}>
                            {data.prompt}
                        </p>
                    </div>
                    
                    <div className="conversation-options">
                        {data.options.map((option, index) => (
                            <button
                                key={index}
                                className={`option-button ${selectedOption === index ? 'selected' : ''}`}
                                onClick={() => handleOptionSelect(index)}
                                disabled={showResult}
                                style={{
                                    background: selectedOption === index ? '#2563eb' : 'white',
                                    color: selectedOption === index ? 'white' : '#0f172a',
                                    border: '2px solid #e2e8f0',
                                    borderRadius: '10px',
                                    padding: '15px 20px',
                                    textAlign: 'left',
                                    cursor: 'pointer',
                                    transition: 'all 0.3s ease',
                                    marginBottom: '10px',
                                    width: '100%'
                                }}
                            >
                                {option.text}
                            </button>
                        ))}
                    </div>
                    
                    {showResult && selectedOption !== null && (
                        <div style={{
                            background: data.options[selectedOption].correct ? '#f0fdf4' : '#fef2f2',
                            border: '2px solid ' + (data.options[selectedOption].correct ? '#10b981' : '#ef4444'),
                            borderRadius: '12px',
                            padding: '20px',
                            margin: '20px 0'
                        }}>
                            <p style={{
                                fontSize: '1.1em',
                                fontWeight: '600',
                                color: data.options[selectedOption].correct ? '#166534' : '#dc2626',
                                marginBottom: '10px'
                            }}>
                                {data.options[selectedOption].correct ? '✅ Excellent choice!' : '❌ Not the best option'}
                            </p>
                            <p style={{color: '#64748b'}}>
                                {data.options[selectedOption].explanation}
                            </p>
                        </div>
                    )}
                    
                    {!showResult && (
                        <button 
                            className="btn btn-primary" 
                            onClick={handleSubmit}
                            disabled={selectedOption === null}
                            style={{marginTop: '20px'}}
                        >
                            Submit Answer
                        </button>
                    )}
                </div>
            );
        };
        
        // VisualExercise Component
        const VisualExercise = ({ data, onComplete }) => {
            const [selectedOption, setSelectedOption] = useState(null);
            const [showResult, setShowResult] = useState(false);
            
            const visualOptions = [
                { emoji: '🃏', text: 'Playing Cards' },
                { emoji: '🍽️', text: 'Dinner Table' },
                { emoji: '☕', text: 'Coffee Cup' },
                { emoji: '👨‍👩‍👧‍👦', text: 'Family' }
            ];
            
            const correctAnswer = 0; // Playing cards for this example
            
            const handleOptionSelect = (optionIndex) => {
                setSelectedOption(optionIndex);
                setShowResult(true);
                setTimeout(() => {
                    onComplete();
                }, 2000);
            };
            
            return (
                <div className="exercise-container">
                    <div className="exercise-type">Visual</div>
                    
                    <div style={{fontSize: '2em', marginBottom: '30px', color: '#0f172a'}}>
                        "{data.target_phrase}"
                    </div>
                    
                    <p style={{fontSize: '1.2em', color: '#64748b', marginBottom: '30px'}}>
                        Select the image that best represents this phrase:
                    </p>
                    
                    <div className="visual-exercise">
                        {visualOptions.map((option, index) => (
                            <div
                                key={index}
                                className={`visual-option ${selectedOption === index ? 'selected' : ''}`}
                                onClick={() => handleOptionSelect(index)}
                            >
                                {option.emoji}
                                <div style={{fontSize: '0.4em', marginTop: '10px', color: '#64748b'}}>
                                    {option.text}
                                </div>
                            </div>
                        ))}
                    </div>
                    
                    {showResult && (
                        <div style={{
                            background: selectedOption === correctAnswer ? '#f0fdf4' : '#fef2f2',
                            border: `2px solid ${selectedOption === correctAnswer ? '#10b981' : '#ef4444'}`,
                            borderRadius: '12px',
                            padding: '20px',
                            margin: '20px 0'
                        }}>
                            <p style={{
                                fontSize: '1.2em',
                                fontWeight: '600',
                                color: selectedOption === correctAnswer ? '#166534' : '#dc2626'
                            }}>
                                {selectedOption === correctAnswer ? '✅ Correct!' : '❌ Try again next time'}
                            </p>
                        </div>
                    )}
                </div>
            );
        };
        
        // SoloPractice Component (simplified for now)
        const SoloPractice = ({ topics, appData, saveProgress }) => {
            const [currentPhrase, setCurrentPhrase] = useState(null);
            const [showAnswer, setShowAnswer] = useState(false);
            const [loading, setLoading] = useState(true);
            
            useEffect(() => {
                loadRandomPhrase();
            }, []);
            
            const loadRandomPhrase = async () => {
                setLoading(true);
                try {
                    const response = await fetch('/api/lesson');
                    const data = await response.json();
                    setCurrentPhrase(data);
                    setShowAnswer(false);
                } catch (error) {
                    console.error('Failed to load phrase:', error);
                } finally {
                    setLoading(false);
                }
            };
            
            const handleKnew = () => {
                const newCount = appData.learnedCount + 1;
                saveProgress({ learnedCount: newCount });
                loadRandomPhrase();
            };
            
            if (loading || !currentPhrase) {
                return (
                    <div style={{textAlign: 'center', padding: '100px 20px'}}>
                        <div className="spinner"></div>
                        <p>Loading phrase...</p>
                    </div>
                );
            }
            
            return (
                <div className="topic-selection fade-in">
                    <div className="topic-header">
                        <h2 className="topic-title">Solo Practice</h2>
                        <p className="topic-subtitle">Practice at your own pace</p>
                    </div>
                    
                    <div className="exercise-container" style={{maxWidth: '600px', margin: '0 auto'}}>
                        <div className="exercise-type">{currentPhrase.lesson_name}</div>
                        
                        <div className="english-prompt">
                            {currentPhrase.english_phrase}
                        </div>
                        
                        {showAnswer && (
                            <>
                                <div className="albanian-answer">
                                    {currentPhrase.target_phrase}
                                </div>
                                {currentPhrase.cultural_context && (
                                    <div className="cultural-note">
                                        {currentPhrase.cultural_context}
                                    </div>
                                )}
                            </>
                        )}
                        
                        <div style={{marginTop: '30px'}}>
                            {!showAnswer ? (
                                <button className="btn btn-primary" onClick={() => setShowAnswer(true)}>
                                    Show Albanian
                                </button>
                            ) : (
                                <div>
                                    <button className="btn btn-success" onClick={handleKnew}>
                                        ✅ I knew it!
                                    </button>
                                    <button className="btn btn-secondary" onClick={loadRandomPhrase}>
                                        → Next phrase
                                    </button>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };
        
        // Render the App
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
        
    </script>
</body>
</html>
